<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Thu Sep  8 02:31:46 2022 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>APPARMOR_PARSER</title>

</head>
<body>

<h1 align="center">APPARMOR_PARSER</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#COMMANDS">COMMANDS</a><br>
<a href="#Unprivileged commands">Unprivileged commands</a><br>
<a href="#Unprivileged profile commands">Unprivileged profile commands</a><br>
<a href="#Privileged commands">Privileged commands</a><br>
<a href="#Privileged profile commands">Privileged profile commands</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#CONFIG FILE">CONFIG FILE</a><br>
<a href="#BUGS">BUGS</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">apparmor_parser
- loads AppArmor profiles into the kernel</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>apparmor_parser
[options] &lt;command&gt; [profiles]...</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>apparmor_parser
[options] &lt;command&gt;</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>apparmor_parser
[-hv] [--help] [--version]</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>apparmor_parser</b>
is used as a general tool to compile, and manage AppArmor
policy, including loading new <b>apparmor.d</b>(5) profiles
into the Linux kernel.</p>

<p style="margin-left:11%; margin-top: 1em">AppArmor
profiles restrict the operations available to processes.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>profiles</b> are loaded into the Linux kernel by the
<b>apparmor_parser</b> program. The <b>profiles</b> may be
specified by file name or a directory name containing a set
of profiles. If a directory is specified then the
<b>apparmor_parser</b> will try to do a profile load for
each file in the directory that is not a dot file, or
explicitly black listed (*.dpkg-new, *.dpkg-old,
*.dpkg-dist, *.dpkg-bak, *.dpkg-remove, *.pacsave, *.pacnew,
*.rpmnew, *.rpmsave, *.orig, *.rej, *~). The
<b>apparmor_parser</b> will fall back to taking input from
standard input if a profile or directory is not
supplied.</p>

<p style="margin-left:11%; margin-top: 1em">The input
supplied to <b>apparmor_parser</b> should be in the format
described in <b>apparmor.d</b>(5).</p>

<h2>COMMANDS
<a name="COMMANDS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The command set
is broken into four subcategories. <br>
unprivileged commands</p>

<p style="margin-left:17%;">Commands that don&rsquo;t
require any privilege and don&rsquo;t operate on
profiles.</p>

<p style="margin-left:11%;">unprivileged profile
commands</p>

<p style="margin-left:17%;">Commands that operate on a
profile either specified on the command line or read from
stdin if no profile was specified.</p>

<p style="margin-left:11%;">privileged commands</p>

<p style="margin-left:17%;">Commands that require the
<small>MAC_ADMIN</small> capability within the affected
AppArmor namespace to load policy into the kernel or
filesystem write permissions to update the affected
privileged files (cache etc).</p>

<p style="margin-left:11%;">privileged profile commands</p>

<p style="margin-left:17%;">Commands that require privilege
and operate on profiles.</p>

<h2>Unprivileged commands
<a name="Unprivileged commands"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">-V,
--version</p>

<p style="margin-left:17%;">Print the version number and
exit.</p>

<p style="margin-left:11%;">-h, --help</p>

<p style="margin-left:17%;">Give a quick reference
guide.</p>

<h2>Unprivileged profile commands
<a name="Unprivileged profile commands"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">-N, --names</p>

<p style="margin-left:17%;">Produce a list of policies from
a given set of profiles (implies -K).</p>

<p style="margin-left:11%;">-p, --preprocess</p>

<p style="margin-left:17%;">Apply preprocessing to the
input profile(s) by flattening includes into the output
profile and dump to stdout.</p>

<p style="margin-left:11%;">-S, --stdout</p>

<p style="margin-left:17%;">Writes a binary (cached)
profile to stdout (implies -K and -T).</p>

<p style="margin-left:11%;">-o file, --ofile file</p>

<p style="margin-left:17%;">Writes a binary (cached)
profile to the specified file (implies -K and -T)</p>

<h2>Privileged commands
<a name="Privileged commands"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">--purge-cache</p>

<p style="margin-left:17%;">Unconditionally clear out
cached profiles.</p>

<h2>Privileged profile commands
<a name="Privileged profile commands"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">-a, --add</p>

<p style="margin-left:17%;">Insert the AppArmor definitions
given into the kernel. This is the default action. This
gives an error message if a AppArmor definition by the same
name already exists in the kernel, or if the parser
doesn&rsquo;t understand its input. It reports when an
addition succeeded.</p>

<p style="margin-left:11%;">-r, --replace</p>

<p style="margin-left:17%;">This flag is required if an
AppArmor definition by the same name already exists in the
kernel; used to replace the definition already in the kernel
with the definition given on standard input.</p>

<p style="margin-left:11%;">-R, --remove</p>

<p style="margin-left:17%;">This flag is used to remove an
AppArmor definition already in the kernel. Note that it
still requires a complete AppArmor definition as described
in <b>apparmor.d</b>(5) even though the contents of the
definition aren&rsquo;t used.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">-B,
--binary</p>

<p style="margin-left:17%;">Treat the profile files
specified on the command line (or stdin if none specified)
as binary cache files, produced with the -S or -o options,
and load to the kernel as specified by -a, -r, and -R
(implies -K and -T).</p>

<p style="margin-left:11%;">-C, --Complain</p>

<p style="margin-left:17%;">Force the profile to load in
complain mode.</p>

<p style="margin-left:11%;">-b n, --base n</p>

<p style="margin-left:17%;">Set the base directory for
resolving #include directives defined as relative paths.</p>

<p style="margin-left:11%;">-I n, --Include n</p>

<p style="margin-left:17%;">Add element n to the search
path when resolving #include directives defined as an
absolute paths.</p>

<p style="margin-left:11%;">-f n, --apparmorfs n</p>

<p style="margin-left:17%;">Set the location of the
apparmor security filesystem (default is
&quot;/sys/kernel/security/apparmor&quot;).</p>

<p style="margin-left:11%;">-M n, --features-file n</p>

<p style="margin-left:17%;">Use the features file located
at path &quot;n&quot; (default is
/etc/apparmor.d/cache/.features). If the --cache-loc option
is present, the &quot;.features&quot; file in the specified
cache directory is used.</p>

<p style="margin-left:11%;">-m n, --match-string n</p>

<p style="margin-left:17%;">Only use match features
&quot;n&quot;.</p>

<p style="margin-left:11%;">-n n, --namespace-string n</p>

<p style="margin-left:17%;">Force a profile to load in the
namespace &quot;n&quot;.</p>

<p style="margin-left:11%;">-X, --readimpliesX</p>

<p style="margin-left:17%;">In the case of profiles that
are loading on systems were <small>READ_IMPLIES_EXEC</small>
is set in the kernel for a given process, load the profile
so that any &quot;r&quot; flags are processed as
&quot;mr&quot;.</p>

<p style="margin-left:11%;">-k, --show-cache</p>

<p style="margin-left:17%;">Report the cache processing
(hit/miss details) when loading or saving cached
profiles.</p>

<p style="margin-left:11%;">-K, --skip-cache</p>

<p style="margin-left:17%;">Perform no caching at all:
disables -W, implies -T.</p>

<p style="margin-left:11%;">-T, --skip-read-cache</p>

<p style="margin-left:17%;">By default, if a
profile&rsquo;s cache is found in the location specified by
--cache-loc and the timestamp is newer than the profile, it
will be loaded from the cache. This option disables this
cache loading behavior.</p>

<p style="margin-left:11%;">-W, --write-cache</p>

<p style="margin-left:17%;">Write out cached profiles to
the location specified in --cache-loc. Off by default. In
cases where abstractions have been changed, and the parser
is running with &quot;--replace&quot;, it may make sense to
also use &quot;--skip-read-cache&quot; with the
&quot;--write-cache&quot; option.</p>

<p style="margin-left:11%;">--skip-bad-cache</p>

<p style="margin-left:17%;">Skip updating the cache if it
contains cached profiles in a bad or inconsistent state</p>

<p style="margin-left:11%;">-L, --cache-loc</p>

<p style="margin-left:17%;">Set the location(s) of the
cache directory. This option can accept a comma separated
list of directories, which will be searched in order to find
a matching cache. The first matching cache file found is
used even if a directory later in the search order may
contain a newer cache file.</p>

<p style="margin-left:17%; margin-top: 1em">If multiple
directories are specified and --write-cache has been
specified then cache writes will be made to the first
directory in the list, all other directories will be treated
as read only.</p>

<p style="margin-left:17%; margin-top: 1em">If a cache
directory name needs to have a comma as part of the name, it
can be specified by using a backslash to escape the comma
character in the directory name.</p>

<p style="margin-left:17%; margin-top: 1em">If not
specified the cache location defaults to
/var/cache/apparmor</p>

<p style="margin-left:11%;">--print-cache-dir</p>

<p style="margin-left:17%;">Print the cache directory
location. This path will be a subdirectory of the directory
specified by --cache-loc. The subdirectory used will be
influenced by the features available in the currently
running kernel or by the features specified with the
--match-string or --features-file options.</p>

<p style="margin-left:11%;">-Q, --skip-kernel-load</p>

<p style="margin-left:17%;">Perform all actions except the
actual loading of a profile into the kernel. This is useful
for testing profile generation, caching, etc, without making
changes to the running kernel profiles.</p>

<p style="margin-left:17%; margin-top: 1em">This also
removes the need for privilege to execute the commands that
manage policy in the kernel</p>

<p style="margin-left:11%;">-q, --quiet</p>

<p style="margin-left:17%;">Do not report on the profiles
as they are loaded, and not show warnings.</p>

<p style="margin-left:11%;">-v, --verbose</p>

<p style="margin-left:17%;">Report on the profiles as they
are loaded, and show warnings.</p>

<p style="margin-left:11%;">--warn=n</p>

<p style="margin-left:17%;">Enable various warnings during
policy compilation. A single dump flag can be specified per
--warn option, but the --warn flag can be passed multiple
times.</p>


<p style="margin-left:17%; margin-top: 1em">apparmor_parser
--warn=rules-not-enforced ...</p>

<p style="margin-left:17%; margin-top: 1em">Use --help=warn
to see a full list of which warn flags are supported.</p>

<p style="margin-left:11%;">-d, --debug</p>

<p style="margin-left:17%;">Given once, only checks the
profiles to ensure syntactic correctness. Given twice, dumps
its interpretation of the profile for checking.</p>

<p style="margin-left:11%;">-D n, --dump=n</p>

<p style="margin-left:17%;">Debug flag for dumping various
structures and passes of policy compilation. A single dump
flag can be specified per --dump option, but the dump flag
can be passed multiple times. Note progress flags tend to
also imply the matching stats flag.</p>


<p style="margin-left:17%; margin-top: 1em">apparmor_parser
--dump=dfa-stats --dump=trans-stats &lt;file&gt;</p>

<p style="margin-left:17%; margin-top: 1em">Use --help=dump
to see a full list of which dump flags are supported</p>

<p style="margin-left:11%;">-j n, --jobs=n</p>

<p style="margin-left:17%;">Set the number of jobs used to
compile the specified policy. Where n can be</p>

<p style="margin-left:17%; margin-top: 1em"># - a specific
number of jobs <br>
auto - the # of cpus in the in the system <br>
x# - # * number of cpus</p>

<p style="margin-left:17%; margin-top: 1em">Eg. <br>
-j8 <small>OR</small> --jobs=8 allows for 8 parallel jobs
<br>
-jauto <small>OR</small> --jobs=auto sets the jobs to the #
of cpus <br>
-jx4 <small>OR</small> --jobs=x4 sets the jobs to # of cpus
* 4 <br>
-jx1 is equivalent to -jauto</p>

<p style="margin-left:17%; margin-top: 1em">The default
value is the number of cpus in the system.</p>

<p style="margin-left:11%;">--max-jobs n</p>

<p style="margin-left:17%;">Set a hard cap on the value
that can be specified by the --jobs flag. It takes the same
set of options available to the --jobs option, and defaults
to 8*cpus</p>

<p style="margin-left:11%;">-O n, --optimize=n</p>

<p style="margin-left:17%;">Set the optimization flags used
by policy compilation. A single optimization flag can be
toggled per -O option, but the optimize flag can be passed
multiple times. Turning off some phases of the optimization
can make it so that policy can&rsquo;t complete compilation
due to size constraints (it is entirely possible to create a
dfa with millions of states that will take days or longer to
compile).</p>

<p style="margin-left:17%; margin-top: 1em">Note: The
parser is set to use a balanced default set of flags, that
will result in reasonable compression but not take excessive
amounts of time to complete.</p>

<p style="margin-left:17%; margin-top: 1em">Use
--help=optimize to see a full list of which optimization
flags are supported.</p>

<p style="margin-left:11%;">--abort-on-error Abort
processing of profiles on the first error <br>
encountered, otherwise the parser will continue to try to
compile other <br>
profiles if specified.</p>

<p style="margin-left:17%;">Note: If an error is
encountered while processing profiles the last error
encountered will be used to set the exit code.</p>

<p style="margin-left:11%;">--skip-bad-cache-rebuild The
default behavior of the parser is to check <br>
if a cached version of a profile exists and if it does it
attempt to <br>
load it into the kernel. If that load is rejected, then the
parser will <br>
attempt to rebuild the cache file, and load again.</p>

<p style="margin-left:17%;">This option tells the parser to
not attempt to rebuild the cache on failure, instead the
parser continues on with processing the remaining
profiles.</p>

<p style="margin-left:11%;">--config-file</p>

<p style="margin-left:17%;">Specify the config file to use
instead of /etc/apparmor/parser.conf. This option will be
processed early before regular options regardless of the
order it is specified in.</p>

<p style="margin-left:11%;">--print-config-file</p>

<p style="margin-left:17%;">Print the config file location
that will be used.</p>

<h2>CONFIG FILE
<a name="CONFIG FILE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">An optional
config file /etc/apparmor/parser.conf can be used to specify
the default options for the parser, which then can be
overridden using the command line options.</p>

<p style="margin-left:11%; margin-top: 1em">The config file
ignores leading whitespace and treats lines that begin with
# as comments. Config options are specified one per line
using the same format as the longform command line options
(without the preceding --).</p>

<p style="margin-left:11%; margin-top: 1em">Eg. <br>
#comment</p>


<p style="margin-left:11%; margin-top: 1em">optimize=no-expr-tree
<br>
optimize=compress-fast</p>

<p style="margin-left:11%; margin-top: 1em">As with the
command line some options accumulate and others override,
ie. when there are conflicting versions of switch the last
option is the one chosen.</p>

<p style="margin-left:11%; margin-top: 1em">Eg. <br>
Optimize=no-minimize <br>
Optimize=minimize</p>

<p style="margin-left:11%; margin-top: 1em">would result in
Optimize=minimize being set.</p>

<p style="margin-left:11%; margin-top: 1em">The Include,
Dump, and Optimize options accululate except for the
inversion option (no-X vs. X), and a couple options that
work by setting/clearing multiple options (compress-small).
In that case the option will override the flags it sets but
will may accumulate with others.</p>

<p style="margin-left:11%; margin-top: 1em">All other
options override previously set values.</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">If you find any
bugs, please report them at
&lt;https://bugs.launchpad.net/apparmor/+filebug&gt;.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>apparmor</b>(7),
<b>apparmor.d</b>(5), <b>aa_change_hat</b>(2), and
&lt;https://wiki.apparmor.net&gt;.</p>
<hr>
</body>
</html>
