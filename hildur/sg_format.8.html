<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Thu Sep  8 03:05:15 2022 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>SG_FORMAT</title>

</head>
<body>

<h1 align="center">SG_FORMAT</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#LISTS">LISTS</a><br>
<a href="#PROTECTION INFORMATION">PROTECTION INFORMATION</a><br>
<a href="#NOTES">NOTES</a><br>
<a href="#TAPE">TAPE</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#EXIT STATUS">EXIT STATUS</a><br>
<a href="#AUTHORS">AUTHORS</a><br>
<a href="#REPORTING BUGS">REPORTING BUGS</a><br>
<a href="#COPYRIGHT">COPYRIGHT</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">sg_format -
format, resize a SCSI disk or format a tape</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>sg_format</b>
[<i>--cmplst=</i>{0|1}] [<i>--count=COUNT</i>]
[<i>--dcrt</i>] [<i>--dry-run</i>] [<i>--early</i>]
[<i>--ffmt=FFMT</i>] [<i>--fmtpinfo=FPI</i>]
[<i>--format</i>] [<i>--help</i>] [<i>--ip-def</i>]
[<i>--long</i>] [<i>--mode=MP</i>] [<i>--pfu=PFU</i>]
[<i>--pie=PIE</i>] [<i>--pinfo</i>] [<i>--poll=PT</i>]
[<i>--quick</i>] [<i>--resize</i>] [<i>--rto_req</i>]
[<i>--security</i>] [<i>--six</i>] [<i>--size=LB_SZ</i>]
[<i>--tape=FM</i>] [<i>--timeout=SECS</i>]
[<i>--verbose</i>] [<i>--verify</i>] [<i>--version</i>]
[<i>--wait</i>] <i>DEVICE</i></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Not all SCSI
direct access devices need to be formatted and some have
vendor specific formatting procedures. SCSI disks with
rotating media are probably the largest group that do
support a &rsquo;standard&rsquo; format operation. They are
typically factory formatted to a block size of 512 bytes
with the largest number of blocks that the manufacturer
recommends. The manufacturer&rsquo;s recommendation
typically leaves aside a certain number of tracks, spread
across the media, for reassignment of blocks to logical
block addresses during the life of the disk.</p>

<p style="margin-left:11%; margin-top: 1em">This utility
can format modern SCSI disks and potentially change their
block size (if permitted) and the block count (i.e. number
of accessible blocks on the media also known as
&quot;resizing&quot;). Resizing a disk to less than the
manufacturer&rsquo;s recommended block count is sometimes
called &quot;short stroking&quot; (see NOTES section).
Resizing the block count while not changing the block size
may not require a format operation. The SBC-2 standard (see
www.t10.org) has obsoleted the &quot;format device&quot;
mode page. Many of the low level details found in that mode
page are now left up to the discretion of the manufacturer.
There is a Format Status log page which reports on the
previous successful format operation(s).</p>

<p style="margin-left:11%; margin-top: 1em">When this
utility is used without options (i.e. it is only given a
<i>DEVICE</i> argument) it prints out the existing block
size and block count derived from two sources. These two
sources are a block descriptor in the response to a MODE
SENSE command and the response to a READ CAPACITY command.
The reason for this double check is to detect a &quot;format
corrupt&quot; state (see the NOTES section). This usage will
not modify the disk.</p>

<p style="margin-left:11%; margin-top: 1em">When this
utility is used with the &quot;--format&quot; (or
&quot;-F&quot;) option it will attempt to format the given
DEVICE. In the absence of the <i>--quick</i> option there is
a 15 second pause during which time the user is invited
thrice (5 seconds apart) to abort sg_format. This occurs
just prior the SCSI FORMAT UNIT command being issued. See
the NOTES section for more information.</p>

<p style="margin-left:11%; margin-top: 1em">Protection
information (PI) is optional and is made up of one or more
protection intervals, each made up of 8 bytes associated
with a logical block. When PI is active each logical block
will have 1, 2, 4, 8, etc protection intervals (i.e. a power
of two), interleaved with (and following) the user data to
which they refer. Four protection types are defined with
protection type 0 being no protection intervals. See the
PROTECTION INFORMATION section below for more
information.</p>

<p style="margin-left:11%; margin-top: 1em">When the
<i>--tape=FM</i> option is given then the SCSI FORMAT MEDIUM
command is sent to the <i>DEVICE</i>. FORMAT MEDIUM is
defined in the SSC documents at T10 and prepares a volume
for use. That may include partitioning the medium. See the
section below on TAPE for more information.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Arguments to
long options are mandatory for short options as well. The
options are arranged in alphabetical order based on the long
option name. <b><br>
-C</b>, <b>--cmplst</b>={0|1}</p>

<p style="margin-left:22%;">sets the CMPLST (&quot;complete
list&quot;) bit in the FORMAT UNIT cdb to 0 or 1. If the
value is 0 then the existing GLIST (grown list) is taken
into account. If the value is 1 then the existing GLIST is
ignored. CMPLST defaults to 1 apart from when the
<i>--ffmt=FFMT</i> option&rsquo;s value is non-zero in which
case CMPLST defaults to 0. See the LISTS section below. In
most cases this bit should be left at its default value.</p>

<p style="margin-left:11%;"><b>-c</b>,
<b>--count</b>=<i>COUNT</i></p>

<p style="margin-left:22%;">where <i>COUNT</i> is the
number of blocks to be formatted or media to be resized to.
Can be used with either <i>--format</i> or <i>--resize</i>.
With <i>--format</i> this option need not be given in which
case it is assumed to be zero. <br>
With <i>--format</i> the interpretation of <i>COUNT</i> is:
<br>
(<i>COUNT</i> &gt; 0) : only format the first <i>COUNT</i>
blocks and READ CAPACITY will report <i>COUNT</i> blocks
after format <br>
(<i>COUNT</i> = 0) and block size unchanged : use existing
block count <br>
(<i>COUNT</i> = 0) and block size changed : recommended
maximum block count for new block size <br>
(<i>COUNT</i> = -1) : use recommended maximum block count
<br>
(<i>COUNT</i> &lt; -1) : illegal <br>
With <i>--resize</i> this option must be given and
<i>COUNT</i> has this interpretation: <br>
(<i>COUNT</i> &gt; 0) : after resize READ CAPACITY will
report <i>COUNT</i> blocks <br>
(<i>COUNT</i> = 0) : after resize READ CAPACITY will report
0 blocks <br>
(<i>COUNT</i> = -1) : after resize READ CAPACITY will report
its maximum number of blocks <br>
(<i>COUNT</i> &lt; -1) : illegal <br>
In both cases if the given <i>COUNT</i> exceeds the maximum
number of blocks (for the block size) then the disk reports
an error. See NOTES section below.</p>

<p style="margin-left:11%;"><b>-D</b>, <b>--dcrt</b></p>

<p style="margin-left:22%;">this option sets the DCRT bit
in the FORMAT UNIT command&rsquo;s parameter list header. It
will &quot;disable certification&quot;. Certification
verifies that blocks are usable during the format process.
Using this option may speed the format. The default action
of this utility (i.e. when this option is not given) is to
clear the DCRT bit thereby requesting &quot;media
certification&quot;. When the DCRT bit is set, the FOV bit
must also be set hence sg_format does that.</p>

<p style="margin-left:11%;"><b>-d</b>, <b>--dry-run</b></p>

<p style="margin-left:22%;">this option will parse the
command line, do all the preparation but bypass the actual
FORMAT UNIT or FORMAT MEDIUM commands. Also if the options
would cause the logical block size to change, then the MODE
SELECT command that would do that is also bypassed when the
dry run option is given.</p>

<p style="margin-left:11%;"><b>-e</b>, <b>--early</b></p>

<p style="margin-left:22%;">during a format operation, The
default action of this utility is to poll the disk every 60
seconds (or every 10 seconds if <i>FFMT</i> is non-zero) to
determine the progress of the format operation until it is
finished. When this option is given this utility will exit
&quot;early&quot;, that is as soon as the format operation
has commenced. Then the user can monitor the progress of the
ongoing format operation with other utilities (e.g.
sg_turs(8) or sg_requests(8)). This option and <i>--wait</i>
are mutually exclusive.</p>

<p style="margin-left:11%;"><b>-t</b>,
<b>--ffmt</b>=<i>FFMT</i></p>

<p style="margin-left:22%;"><i>FFMT</i> (fast format) is
placed in a field of the same name in the FORMAT UNIT cdb.
The field was introduced in SBC-4 revision 10. The default
value is 0 which implies the former action which is
typically to overwrite all blocks on the <i>DEVICE</i>. That
can take a long time (e.g. with hard disks over 10 TB in
size that can be days). With <i>FFMT</i> set that time may
be reduced to minutes. So it is worth trying if it is
available. <i><br>
FFMT</i> has values 1 and 2 for fast format with 3 being
reserved currently. These two values include this
description: &quot;The device server initializes the medium
... without overwriting the medium (i.e. resources for
managing medium access are initialized and the medium is not
written)&quot;. The difference between 1 and 2 concerns read
operations on LBAs to which no data has been written to,
after the fast format. When <i>FFMT</i> is 1 the read
operation should return &quot;unspecified logical block
data&quot; and complete without error. When <i>FFMT</i> is 2
the read operation may yield check condition status with a
sense key set to hardware error, medium error or command
aborted. See SBC-4 revision 15 section 4.35 for more
details.</p>

<p style="margin-left:11%;"><b>-f</b>,
<b>--fmtpinfo</b>=<i>FPI</i></p>

<p style="margin-left:22%;">sets the FMTPINFO field in the
FORMAT UNIT cdb to a value between 0 and 3. The default
value is 0. The FMTPINFO field from SBC-3 revision 16 is a 2
bit field (bits 7 and 6 of byte 1 in the cdb). Prior to that
revision it was a single bit field (bit 7 of byte 1 in the
cdb) and there was an accompanying bit called RTO_REQ (bit 6
of byte 1 in the cdb). The deprecated options
&quot;--pinfo&quot; and &quot;--rto-req&quot; represent the
older usage. This option should be used in their place. See
the PROTECTION INFORMATION section below for more
information.</p>

<p style="margin-left:11%;"><b>-F</b>, <b>--format</b></p>

<p style="margin-left:22%;">issue a SCSI FORMAT UNIT
command. <b>This will destroy all the data held on the
media.</b> This option is required to change the block size
of a disk. In the absence of the <i>--quick</i> option, the
user is given a 15 second count down to ponder the wisdom of
doing this, during which time control-C (amongst other Unix
commands) can be used to kill this process before it does
any damage. <br>
When used three times (or more) the preliminary MODE SENSE
and SELECT commands are bypassed, leaving only the initial
INQUIRY and FORMAT UNIT commands. This is for emergency use
(e.g. when the MODE SENSE/SELECT commands are not working)
and cannot change the logical block size. <br>
See NOTES section for implementation details and EXAMPLES
section for typical use.</p>

<p style="margin-left:11%;"><b>-h</b>, <b>--help</b></p>

<p style="margin-left:22%;">print out the usage information
then exit.</p>

<p style="margin-left:11%;"><b>-I</b>, <b>--ip-def</b></p>

<p style="margin-left:22%;">sets the default Initialization
Pattern. Some disks (SSDs) use this to flag that a format
should fully provision (i.e. associate a physical block with
every logical block). The same disks (SSDs) might thin
provision if this option is not given. If this option is
given then the <i>--security</i> option cannot be given.
Also accepts <i>--ip_def</i> for this option.</p>

<p style="margin-left:11%;"><b>-l</b>, <b>--long</b></p>

<p style="margin-left:22%;">the default action of this
utility is to assume 32 bit logical block addresses. With
512 byte block size this permits more than 2 terabytes
(almost 2 ** 41 bytes) on a single disk. This option selects
commands and parameters that allow for 64 bit logical block
addresses. Specifically this option sets the
&quot;longlba&quot; flag in the MODE SENSE (10) command and
uses READ CAPACITY (16) rather than READ CAPACITY (10). If
this option is not given and READ CAPACITY (10) or MODE
SELECT detects a disk the needs more than 32 bits to
represent its logical blocks then it is set internally. This
option does not set the LONGLIST bit in the FORMAT UNIT
command. The LONGLIST bit is set as required depending other
parameters (e.g. when &rsquo;--pie=PIE&rsquo; is greater
than zero).</p>

<p style="margin-left:11%;"><b>-M</b>,
<b>--mode</b>=<i>MP</i></p>

<p style="margin-left:22%;"><i>MP</i> is a mode page number
(0 to 62 inclusive) that will be used for reading and
perhaps changing the device logical block size. The default
is 1 which is the Read-Write Error Recovery mode page. <br>
Preferably the chosen (or default) mode page should be
saveable (i.e. accept the SP bit set in the MODE SELECT
command used when the logical block size is being changed).
Recent version of this utility will retry a MODE SELECT if
the SP=1 variant fails with a sense key of ILLEGAL REQUEST.
That retry will use the same MODE SELECT command but with
SP=0 .</p>

<p style="margin-left:11%;"><b>-P</b>,
<b>--pfu</b>=<i>PFU</i></p>

<p style="margin-left:22%;">sets the &quot;Protection Field
Usage&quot; field in the parameter block associated with a
FORMAT UNIT command to <i>PFU</i>. The default value is 0,
the only other defined value currently is 1. See the
PROTECTION INFORMATION section below for more
information.</p>

<p style="margin-left:11%;"><b>-q</b>,
<b>--pie</b>=<i>PIE</i></p>

<p style="margin-left:22%;">sets the &quot;Protection
Interval Exponent&quot; field in the parameter block
associated with a FORMAT UNIT command to <i>PIE</i>. The
default value is 0. <i>PIE</i> can only be non-zero with
protection types 2 and 3. The value of 0 is typical for 512
byte blocks; with 4096 byte blocks a value of 3 may be
appropriate (i.e. 8 protection intervals interleaved with
4096 bytes of user data). A device may not support any
non-zero values. This field first appeared in SBC-3 revision
18.</p>

<p style="margin-left:11%;"><b>-p</b>, <b>--pinfo</b></p>

<p style="margin-left:22%;">this option is deprecated, use
the <i>--fmtpinfo=FPI</i> option instead. If used, then it
sets bit 7 of byte 1 in the FORMAT UNIT cdb and that is
equivalent to setting <i>--fmtpinfo=2</i>. [So if
<i>--pinfo</i> is used (plus <i>--fmtpinfo=FPI</i> and
<i>--pfu=PFU</i> are not given or their arguments are 0)
then protection type 1 is selected.]</p>

<p style="margin-left:11%;"><b>-x</b>,
<b>--poll</b>=<i>PT</i></p>

<p style="margin-left:22%;">where <i>PT</i> is the type of
poll used. If <i>PT</i> is 0 then a TEST UNIT READY command
is used, otherwise a REQUEST SENSE command is used. The
default is currently 0 but this will change to 1 in the near
future. See the NOTES sections below.</p>

<p style="margin-left:11%;"><b>-Q</b>, <b>--quick</b></p>

<p style="margin-left:22%;">the default action (i.e. when
the option is not given) is to give the user 15 seconds to
reconsider doing a format operation on the <i>DEVICE</i>.
When this option is given that step (i.e. the 15 second
warning period) is skipped.</p>

<p style="margin-left:11%;"><b>-r</b>, <b>--resize</b></p>

<p style="margin-left:22%;">rather than format the disk, it
can be resized. This means changing the number of blocks on
the device reported by the READ CAPACITY command. This
option should be used with the <i>--count=COUNT</i> option.
The contents of all logical blocks on the media remain
unchanged when this option is used. This means that any
resize operation can be reversed. This option cannot be used
together with either <i>--format</i> or a
<i>--size=LB_SZ</i> whose argument is different to the
existing block size.</p>

<p style="margin-left:11%;"><b>-R</b>, <b>--rto_req</b></p>

<p style="margin-left:22%;">The option is deprecated, use
the <i>--fmtpinfo=FPI</i> option instead. If used, then it
sets bit 6 of byte 1 in the FORMAT UNIT cdb.</p>

<p style="margin-left:11%;"><b>-S</b>,
<b>--security</b></p>

<p style="margin-left:22%;">sets the &quot;Security
Initialization&quot; (SI) bit in the FORMAT UNIT
command&rsquo;s initialization pattern descriptor within the
parameter list. According to SBC-3 the default
initialization pattern &quot;shall be written using a
security erasure write technique&quot;. See the NOTES
section on the SCSI SANITIZE command. If this option is
given then the <i>--ip_def</i> option cannot be given.</p>

<p style="margin-left:11%;"><b>-6</b>, <b>--six</b></p>

<p style="margin-left:22%;">Use 6 byte variants of MODE
SENSE and MODE SELECT. The default action is to use the 10
byte variants. Some MO drives need this option set when
doing a format.</p>

<p style="margin-left:11%;"><b>-s</b>,
<b>--size</b>=<i>LB_SZ</i></p>

<p style="margin-left:22%;">where <i>LB_SZ</i> is the
logical block size (i.e. number of user bytes in each block)
to format the device to. The default value is whatever is
currently reported by the block descriptor in a MODE SENSE
command. If the block size given by this option is different
from the current value then a MODE SELECT command is used to
change it prior to the FORMAT UNIT command being started (as
recommended in the SBC standards). Some SCSI disks have 512
byte logical blocks by default and allow an alternate
logical block size of 4096 bytes. If the given size in
unacceptable to the disk, most likely an &quot;Invalid field
in parameter list&quot; message will appear in sense data
(requires the use of &rsquo;-v&rsquo; to decode sense data).
<br>
Note that formatting a disk to add or remove protection
information is not regarded as a change to its logical block
size so this option should not be used.</p>

<p style="margin-left:11%;"><b>-T</b>,
<b>--tape</b>=<i>FM</i></p>

<p style="margin-left:22%;">will send a FORMAT MEDIUM
command to the <i>DEVICE</i> with its FORMAT field set to
<i>FM</i>. This option is used to prepare a tape (i.e. the
&quot;medium&quot;) in a tape drive for use. Values for
<i>FM</i> include 0 to do the &quot;default&quot; format; 1
to partition a volume and 2 to do a default format then
partition.</p>

<p style="margin-left:11%;"><b>-m</b>,
<b>--timeout</b>=<i>SECS</i></p>

<p style="margin-left:22%;">where <i>SECS</i> is the FORMAT
UNIT or FORMAT MEDIUM command timeout in seconds.
<i>SECS</i> will only be used if it exceeds the internal
timeout which is 20 seconds if the IMMED bit is set and
72000 seconds (20 hours) or higher if the IMMED bit is not
set. If the disk size exceeds 4 TB then the timeout value is
increased to 144000 seconds (40 hours). And if it is greater
than 8 TB then the timeout value is increased to 288000
seconds (80 hours). If the timeout is exceeded then the
operating system will typically abort the command. Aborting
a command may escalate to a LUN reset (or worse). A timeout
may also leave the disk or tape format operation incomplete.
And that may result in the disk or tape being in a
&quot;format corrupt&quot; state requiring another format to
remedy the situation. So for various reasons timeouts are
best avoided.</p>

<p style="margin-left:11%;"><b>-v</b>, <b>--verbose</b></p>

<p style="margin-left:22%;">increase the level of
verbosity, (i.e. debug output). &quot;-vvv&quot; gives a lot
more debug output.</p>

<p style="margin-left:11%;"><b>-y</b>, <b>--verify</b></p>

<p style="margin-left:22%;">set the VERIFY bit in the
FORMAT MEDIUM cdb. The default is that the VERIFY bit is
clear. This option is only appropriate for tapes.</p>

<p style="margin-left:11%;"><b>-V</b>, <b>--version</b></p>

<p style="margin-left:22%;">print the version string and
then exit.</p>

<p style="margin-left:11%;"><b>-w</b>, <b>--wait</b></p>

<p style="margin-left:22%;">the default format action is to
set the &quot;IMMED&quot; bit in the FORMAT UNIT
command&rsquo;s (short) parameter header. If this option
(i.e. <i>--wait</i>) is given then the &quot;IMMED&quot; bit
is not set. If <i>--wait</i> is given then the FORMAT UNIT
or FORMAT MEDIUM command waits until the format operation
completes before returning its response. This can be many
hours on large disks. See the <i>--timeout=SECS</i>
option.</p>

<h2>LISTS
<a name="LISTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The SBC-3 draft
(revision 20) defines PLIST, CLIST, DLIST and GLIST in
section 4.10 on &quot;Medium defects&quot;. Briefly, the
PLIST is the &quot;primary&quot; list of manufacturer
detected defects, the CLIST (&quot;certification&quot; list)
contains those detected during the format operation, the
DLIST is a list of defects that can be given to the format
operation. The GLIST is the grown list which starts in the
format process as CLIST+DLIST and can &quot;grow&quot; later
due to automatic reallocation (see the ARRE and AWRE bits in
the Read-Write Error Recovery mode page (see sdparm(8))) and
use of the SCSI REASSIGN BLOCKS command (see
sg_reassign(8)).</p>

<p style="margin-left:11%; margin-top: 1em">By the SBC-3
standard (following draft revision 36) the CLIST and DLIST
had been removed, leaving PLIST and GLIST. Only PLIST and
GLIST are found in the SBC-4 drafts.</p>

<p style="margin-left:11%; margin-top: 1em">The CMPLST bit
(controlled by the <i>--cmplst=</i>0|1 option) determines
whether the existing GLIST, when the format operation is
invoked, is taken into account. The sg_format utility sets
the FOV bit to zero which causes DPRY=0, so the PLIST is
taken into account, and DCRT=0, so the CLIST is generated
and used during the format process.</p>

<p style="margin-left:11%; margin-top: 1em">The sg_format
utility does not permit a user to provide a defect list
(i.e. DLIST).</p>

<h2>PROTECTION INFORMATION
<a name="PROTECTION INFORMATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Protection
Information (PI) is additional information held with logical
blocks so that an application and/or host bus adapter can
check the correctness of those logical blocks. PI is placed
in one or more protection intervals interleaved in each
logical block. Each protection interval follows the user
data to which it refers. A protection interval contains 8
bytes made up of a 2 byte &quot;logical block guard&quot;
(CRC), a 2 byte &quot;logical block application guard&quot;,
and a 4 byte &quot;logical block reference tag&quot;.
Devices with 512 byte logical block size typically have one
protection interval appended, making its logical block data
520 bytes long. Devices with 4096 byte logical block size
often have 8 protection intervals spread across its logical
block data for a total size of 4160 bytes. Note that for all
other purposes the logical block size is considered to be
512 and 4096 bytes respectively.</p>

<p style="margin-left:11%; margin-top: 1em">The SBC-3
standard have added several &quot;protection types&quot; to
the PI introduced in the SBC-2 standard. SBC-3 defines 4
protection types (types 0 to 3) with protection type 0
meaning no PI is maintained. While a device may support one
or more protection types, it can only be formatted with 1 of
the 4. To change a device&rsquo;s protection type, it must
be re-formatted. For more information see the Protection
Information in section 4.22 of draft SBC-4 revision 15.</p>

<p style="margin-left:11%; margin-top: 1em">A device that
supports PI information (i.e. supports one or more
protection types 1, 2 and 3) sets the &quot;PROTECT&quot;
bit in its standard INQUIRY response. It also sets the SPT
field in the EXTENDED INQUIRY VPD page response to indicate
which protection types it supports. Given PROTECT=1 then
SPT=0 implies the device supports PI type 1 only, SPT=1
implies the device supports PI types 1 and 2, and various
other non-obvious mappings up to SPT=7 which implies
protection types 1, 2 and 3 are supported. The
<b>current</b> protection type of a disk can be found in the
&quot;P_TYPE&quot; and &quot;PROT_EN&quot; fields in the
response of a READ CAPACITY (16) command (e.g. with the
&rsquo;sg_readcap --long&rsquo; utility).</p>

<p style="margin-left:11%; margin-top: 1em">Given that a
device supports a particular protection type, a user can
then choose to format that disk with that protection type by
setting the &quot;FMTPINFO&quot; and &quot;Protection Field
Usage&quot; fields in the FORMAT UNIT command. Those fields
correspond to the <i>--fmtpinfo=FPI</i> and the
<i>--pfu=PFU</i> options in this utility. The list below
shows the four protection types followed by the options of
this utility needed to select them: <b><br>
0</b> : --fmtpinfo=0 --pfu=0 <b><br>
1</b> : --fmtpinfo=2 --pfu=0 <b><br>
2</b> : --fmtpinfo=3 --pfu=0 <b><br>
3</b> : --fmtpinfo=3 --pfu=1 <br>
The default value of <i>FPI</i> (in <i>--fmtpinfo=FPI</i>)
is 0 and the default value of <i>PFU</i> (in
<i>--pfu=PFU</i>) is 0. So if neither <i>--fmtpinfo=FPI</i>
nor <i>--pfu=PFU</i> are given then protection type 0 (i.e.
no protection information) is chosen.</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">After a format
that changes the logical block size or the number of logical
blocks on a disk, the operating system may need to be told
to re-initialize its setting for that disk. In Linux that
can be done with: <br>
echo 1 &gt; /sys/block/sd{letter(s)}/device/rescan <br>
where &quot;letter(s)&quot; will be between &rsquo;a&rsquo;
and &rsquo;zzz&rsquo;. The lsscsi utility in Linux can be
used to check the various namings of a disk.</p>

<p style="margin-left:11%; margin-top: 1em">The SBC-2
standard states that the REQUEST SENSE command should be
used for obtaining progress indication when the format
command is underway. However, tests on a selection of disks
shows that TEST UNIT READY commands yield progress
indications (but not REQUEST SENSE commands). So the current
version of this utility defaults to using TEST UNIT READY
commands to poll the disk to find out the progress of the
format. The <i>--poll=PT</i> option has been added to
control this.</p>

<p style="margin-left:11%; margin-top: 1em">When the
<i>--format</i> option is given without the <i>--wait</i>
option then the SCSI FORMAT UNIT command is issued with the
IMMED bit set which causes the SCSI command to return after
it has started the format operation. The <i>--early</i>
option will cause sg_format to exit at that point. Otherwise
the <i>DEVICE</i> is polled every 60 seconds or every 10
seconds if <i>FFMT</i> is non-zero. The poll is with TEST
UNIT READY or REQUEST SENSE commands until one reports an
&quot;all clear&quot; (i.e. the format operation has
completed). Normally these polling commands will result in a
progress indicator (expressed as a percentage) being output
to the screen. If the user gets bored watching the progress
report then sg_format process can be terminated (e.g. with
control-C) without affecting the format operation which
continues. However a target or device reset (or a power
cycle) will probably cause the device to become &quot;format
corrupt&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">When the
<i>--format</i> (or <i>--tape</i>) and <i>--wait</i> options
are both given then this utility may take a long time to
return. In this case care should be taken not to send any
other SCSI commands to the disk as it may not respond
leaving those commands queued behind the active format
command. This may cause a timeout in the OS driver (in a lot
shorter period than 20 hours applicable to some format
operations). This may result in the OS resetting the disk
leaving the format operation incomplete. This may leave the
disk in a &quot;format corrupt&quot; state requiring another
format to remedy the situation. Modern SCSI devices should
yield a &quot;not ready&quot; sense key with an additional
sense indicating a format is in progress. With older devices
the user should take precautions that nothing attempts to
access a device while it is being formatted.</p>

<p style="margin-left:11%; margin-top: 1em">When the block
size (i.e. the number of bytes in each block) is changed on
a disk two SCSI commands must be sent: a MODE SELECT to
change the block size followed by a FORMAT command. If the
MODE SELECT command succeeds and the FORMAT fails then the
disk may be in a state that the standard calls &quot;format
corrupt&quot;. A block descriptor in a subsequent MODE SENSE
will report the requested new block size while a READ
CAPACITY command will report the existing (i.e. previous)
block size. Alternatively the READ CAPACITY command may
fail, reporting the device is not ready, potentially
requiring a format. The solution to this situation is to do
a format again (and this time the new block size does not
have to be given) or change the block size back to the
original size.</p>

<p style="margin-left:11%; margin-top: 1em">The SBC-2
standard states that the block count can be set back to the
manufacturer&rsquo;s maximum recommended value in a format
or resize operation. This can be done by placing an address
of 0xffffffff (or the 64 bit equivalent) in the appropriate
block descriptor field to a MODE SELECT command. In signed
(two&rsquo;s complement) arithmetic that value corresponds
to &rsquo;-1&rsquo;. So a --count=-1 causes the block count
to be set back to the manufacturer&rsquo;s maximum
recommended value. To see exactly which SCSI commands are
being executed and parameters passed add the
&quot;-vvv&quot; option to the sg_format command line.</p>

<p style="margin-left:11%; margin-top: 1em">The FMTDATA
field shown in the FORMAT UNIT cdb does not have a
corresponding option in this utility. When set in the cdb it
indicates an additional parameter list will be sent to the
<i>DEVICE</i> along with the cdb. It is set as required,
basically when any field in the parameter list header is
set.</p>

<p style="margin-left:11%; margin-top: 1em">Short stroking
is a technique to trade off capacity for performance on hard
disks. &quot;Hard&quot; disk is often used to mean a storage
device with spinning platters which contain the user data.
Solid State Disk (SSD) is the newer form of storage device
that contains no moving parts. Hard disk performance is
usually highest on the outer tracks (usually the lower
logical block addresses) so by resizing or reformatting a
disk to a smaller capacity, average performance will usually
be increased.</p>

<p style="margin-left:11%; margin-top: 1em">Other utilities
may be useful in finding information associated with
formatting. These include sg_inq(8) to fetch standard
INQUIRY information (e.g. the PROTECT bit) and to fetch the
EXTENDED INQUIRY VPD page (e.g. RTO and GRD_CHK bits). The
sdparm(8) utility can be used to access and potentially
change the now obsolete format mode page.</p>

<p style="margin-left:11%; margin-top: 1em">scsiformat is
another utility available for formatting SCSI disks with
Linux. It dates from 1997 (most recent update) and may be
useful for disks whose firmware is of that vintage.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>COUNT</i> numeric argument may include a multiplicative
suffix or be given in hexadecimal. See the &quot;NUMERIC
ARGUMENTS&quot; section in the sg3_utils(8) man page.</p>

<p style="margin-left:11%; margin-top: 1em">The SCSI
SANITIZE command was introduced in SBC-3 revision 27. It is
closely related to the ATA sanitize disk feature set and can
be used to remove all existing data from a disk. Sanitize is
more likely to be implemented on modern disks (including
SSDs) than FORMAT UNIT&rsquo;s security initialization
feature (see the <i>--security</i> option) and in some cases
much faster.</p>

<p style="margin-left:11%; margin-top: 1em">SSDs that
support thin provisioning will typically unmap all logical
blocks during a format. The reason is to improve the
SSD&rsquo;s endurance. Also thin provisioned formats
typically complete faster than fully provisioned ones on the
same disk (see the <i>--ip_def</i> option). In either case
format operations on SSDs tend to be a lot faster than they
are on hard disks with spinning media.</p>

<h2>TAPE
<a name="TAPE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Tape system use
a variant of the FORMAT UNIT command used on disks. Tape
systems use the FORMAT MEDIUM command which is simpler with
only three fields in the cdb typically used. Apart from
sharing the same opcode the cdbs of FORMAT UNIT and FORMAT
MEDIUM are quite different. FORMAT MEDIUM&rsquo;s fields are
VERIFY, IMMED and FORMAT (with TRANSFER LENGTH always set to
0). The VERIFY bit field is set with the <i>--verify</i>
option. The IMMED bit is manipulated by the <i>--wait</i>
option in the same way it is for disks; one difference is
that if the <i>--poll=PT</i> option is not given then it
defaults to <i>PT</i> of 1 which means the poll is done with
REQUEST SENSE commands.</p>

<p style="margin-left:11%; margin-top: 1em">The argument
given to the <i>--tape=FM</i> option is used to set the
FORMAT field. <i>FM</i> can take values from &quot;-1&quot;
to &quot;15&quot; where &quot;-1&quot; (the default) means
don&rsquo;t do a tape format; value &quot;8&quot; to
&quot;15&quot; are for vendor specific formats. The
<i>--early</i> option may also be used to set the IMMED bit
and then exit this utility (rather than poll periodically
until it is finished). In this case the tape drive will
still be busy doing the format for some time but, according
to T10, should still respond in full to the INQUIRY and
REPORT LUNS commands. Other commands (including REQUEST
SENSE) should yield a &quot;not ready&quot; sense key with
an additional sense code of &quot;Logical unit not ready,
format in progress&quot;. Additionally REQUEST SENSE should
contain a progress indication in its sense data.</p>

<p style="margin-left:11%; margin-top: 1em">When <i>FM</i>
is 1 or 2 then the settings in the Medium partition mode
page control the partitioning. That mode page can be viewed
and modified with the sdparm utility.</p>

<p style="margin-left:11%; margin-top: 1em">Prior to
invoking this utility the tape may need to be positioned to
the beginning of partition 0. In Linux that can typically be
done with the mt utility (e.g. &rsquo;mt -f /dev/st0
rewind&rsquo;).</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">These examples
use Linux device names. For suitable device names in other
supported Operating Systems see the sg3_utils(8) man
page.</p>

<p style="margin-left:11%; margin-top: 1em">In the first
example below simply find out the existing block count and
size derived from two sources: a block descriptor in a MODE
SELECT command response and from the response of a READ
CAPACITY commands. No changes are made:</p>

<p style="margin-left:11%; margin-top: 1em"># sg_format
/dev/sdm</p>

<p style="margin-left:11%; margin-top: 1em">Now a simple
format, leaving the block count and size as they were
previously. The FORMAT UNIT command is executed in IMMED
mode and the device is polled every 60 seconds to print out
a progress indication:</p>

<p style="margin-left:11%; margin-top: 1em"># sg_format
--format /dev/sdm</p>

<p style="margin-left:11%; margin-top: 1em">Now the same
format, but waiting (passively) until the format operation
is complete:</p>

<p style="margin-left:11%; margin-top: 1em"># sg_format
--format --wait /dev/sdm</p>

<p style="margin-left:11%; margin-top: 1em">Next is a
format in which the block size is changed to 520 bytes and
the block count is set to the manufacturer&rsquo;s maximum
value (for that block size). Note, not all disks support
changing the block size:</p>

<p style="margin-left:11%; margin-top: 1em"># sg_format
--format --size=520 /dev/sdm</p>

<p style="margin-left:11%; margin-top: 1em">Now a resize
operation so that only the first 0x10000 (65536) blocks on a
disk are accessible. The remaining blocks remain
unaltered.</p>

<p style="margin-left:11%; margin-top: 1em"># sg_format
--resize --count=0x10000 /dev/sdm</p>

<p style="margin-left:11%; margin-top: 1em">Now resize the
disk back to its normal (maximum) block count:</p>

<p style="margin-left:11%; margin-top: 1em"># sg_format
--resize --count=-1 /dev/sdm</p>

<p style="margin-left:11%; margin-top: 1em">One reason to
format a SCSI disk is to add protection information. First
check which protection types are supported by a disk (by
checking the SPT field in the Extended inquiry VPD page
together with the Protect bit in the standard inquiry
response):</p>

<p style="margin-left:11%; margin-top: 1em"># sg_vpd -p ei
-l /dev/sdb <br>
extended INQUIRY data VPD page: <br>
ACTIVATE_MICROCODE=0 <br>
SPT=1 [protection types 1 and 2 supported] <br>
....</p>

<p style="margin-left:11%; margin-top: 1em">Format with
type 1 protection:</p>

<p style="margin-left:11%; margin-top: 1em"># sg_format
--format --fmtpinfo=2 /dev/sdm</p>

<p style="margin-left:11%; margin-top: 1em">After a
successful format with type 1 protection, READ CAPACITY(16)
should show something like this:</p>

<p style="margin-left:11%; margin-top: 1em"># sg_readcap -l
/dev/sdm <br>
Read Capacity results: <br>
Protection: prot_en=1, p_type=0, p_i_exponent=0 [type 1
protection] <br>
Logical block provisioning: lbpme=0, lbprz=0 <br>
....</p>

<p style="margin-left:11%; margin-top: 1em">To format with
type 3 protection:</p>

<p style="margin-left:11%; margin-top: 1em"># sg_format
--format --fmtpinfo=3 --pfu=1 /dev/sdm</p>

<p style="margin-left:11%; margin-top: 1em">For the disk
shown above this will probably fail because the Extended
inquiry VPD page showed only types 1 and 2 protection are
supported.</p>

<p style="margin-left:11%; margin-top: 1em">Here are
examples of using fast format (FFMT field in FORMAT UNIT
cdb) to quickly switch between 512 and 4096 byte logical
block size. Assume disk starts with 4096 byte logical block
size and all important data has been backed up.</p>

<p style="margin-left:11%; margin-top: 1em"># sg_format
--format --ffmt=1 --size=512 /dev/sdd</p>

<p style="margin-left:11%; margin-top: 1em">Now /dev/sdd
should have 512 byte logical block size. And to switch it
back:</p>

<p style="margin-left:11%; margin-top: 1em"># sg_format
--format --ffmt=1 --size=4096 /dev/sdd</p>

<h2>EXIT STATUS
<a name="EXIT STATUS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The exit status
of sg_format is 0 when it is successful. Otherwise see the
sg3_utils(8) man page. Unless the <i>--wait</i> option is
given, the exit status may not reflect the success of
otherwise of the format. Using sg_turs(8) and sg_readcap(8)
after the format operation may be wise.</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Written by
Grant Grundler, James Bottomley and Douglas Gilbert.</p>

<h2>REPORTING BUGS
<a name="REPORTING BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Report bugs to
&lt;dgilbert at interlog dot com&gt;.</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Copyright
&copy; 2005-2018 Grant Grundler, James Bottomley and Douglas
Gilbert <br>
This software is distributed under the GPL version 2. There
is NO warranty; not even for MERCHANTABILITY or FITNESS FOR
A PARTICULAR PURPOSE.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>sg_turs(8),
sg_requests(8), sg_inq(8), sg_modes(8), sg_vpd(8),
sg_reassign(8), sg_readcap(8), sg3_utils(8), sg_sanitize(8)
[all in sg3_utils], lsscsi(8), mt(mt-st), sdparm(8),
scsiformat (old), hdparm(8)</b></p>
<hr>
</body>
</html>
