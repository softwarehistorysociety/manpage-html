<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Thu Sep  8 03:05:39 2022 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>SG_WRITE_X</title>

</head>
<body>

<h1 align="center">SG_WRITE_X</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#SCATTERED FILE ASCII FORMAT">SCATTERED FILE ASCII FORMAT</a><br>
<a href="#NOTES">NOTES</a><br>
<a href="#EXIT STATUS">EXIT STATUS</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#AUTHORS">AUTHORS</a><br>
<a href="#REPORTING BUGS">REPORTING BUGS</a><br>
<a href="#COPYRIGHT">COPYRIGHT</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">sg_write_x -
SCSI WRITE normal/ATOMIC/SAME/SCATTERED/STREAM, ORWRITE
commands</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>sg_write_x</b>
[<i>--16</i>] [<i>--32</i>] [<i>--app-tag=AT</i>]
[<i>--atomic=AB</i>] [<i>--bmop=OP,PGP</i>] [<i>--bs=BS</i>]
[<i>--combined=DOF</i>] [<i>--dld=DLD</i>] [<i>--dpo</i>]
[<i>--dry-run</i>] [<i>--fua</i>]
[<i>--generation=EOG,NOG</i>] [<i>--grpnum=GN</i>]
[<i>--help</i>] <i>--in=IF</i> [<i>--lba=LBA[,LBA...]</i>]
[<i>--normal</i>] [<i>--num=NUM[,NUM...]</i>]
[<i>--offset=OFF[,DLEN]</i>] [<i>--or</i>] [<i>--quiet</i>]
[<i>--ref-tag=RT</i>] [<i>--same=NDOB</i>]
[<i>--scat-file=SF</i>] [<i>--scat-raw</i>]
[<i>--scattered=RD</i>] [<i>--stream=ID</i>]
[<i>--strict</i>] [<i>--tag-mask=TM</i>]
[<i>--timeout=TO</i>] [<i>--unmap=U_A</i>]
[<i>--verbose</i>] [<i>--version</i>]
[<i>--wrprotect=WPR</i>] <i>DEVICE</i></p>

<p style="margin-left:11%; margin-top: 1em">Synopsis per
supported command:</p>


<p style="margin-left:11%; margin-top: 1em"><b>sg_write_x</b>
<i>--normal --in=IF</i> [<i>--16</i>] [<i>--32</i>]
[<i>--app-tag=AT</i>] [<i>--bs=BS</i>] [<i>--dld=DLD</i>]
[<i>--dpo</i>] [<i>--fua</i>] [<i>--grpnum=GN</i>]
[<i>--lba=LBA</i>] [<i>--num=NUM</i>]
[<i>--offset=OFF[,DLEN]</i>] [<i>--ref-tag=RT</i>]
[<i>--strict</i>] [<i>--tag-mask=TM</i>]
[<i>--timeout=TO</i>] [<i>--wrprotect=WPR</i>]
<i>DEVICE</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>sg_write_x</b>
<i>--or --in=IF</i> [<i>--16</i>] [<i>--32</i>]
[<i>--bmop=OP,PGP</i>] [<i>--bs=BS</i>] [<i>--dpo</i>]
[<i>--fua</i>] [<i>--generation=EOG,NOG</i>]
[<i>--grpnum=GN</i>] [<i>--lba=LBA</i>] [<i>--num=NUM</i>]
[<i>--offset=OFF[,DLEN]</i>] [<i>--strict</i>]
[<i>--timeout=TO</i>] [<i>--wrprotect=OPR</i>]
<i>DEVICE</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>sg_write_x</b>
<i>--atomic=AB --in=IF</i> [<i>--16</i>] [<i>--32</i>]
[<i>--app-tag=AT</i>] [<i>--bs=BS</i>] [<i>--dpo</i>]
[<i>--fua</i>] [<i>--grpnum=GN</i>] [<i>--lba=LBA</i>]
[<i>--num=NUM</i>] [<i>--offset=OFF[,DLEN]</i>]
[<i>--ref-tag=RT</i>] [<i>--strict</i>]
[<i>--timeout=TO</i>] [<i>--wrprotect=WPR</i>]
<i>DEVICE</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>sg_write_x</b>
<i>--same=NDOB</i> [<i>--16</i>] [<i>--32</i>]
[<i>--app-tag=AT</i>] [<i>--bs=BS</i>] [<i>--dpo</i>]
[<i>--fua</i>] [<i>--grpnum=GN</i>] [<i>--in=IF</i>]
[<i>--lba=LBA</i>] [<i>--num=NUM</i>]
[<i>--offset=OFF[,DLEN]</i>] [<i>--ref-tag=RT</i>]
[<i>--strict</i>] [<i>--timeout=TO</i>] [<i>--unmap=U_A</i>]
[<i>--wrprotect=WPR</i>] <i>DEVICE</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>sg_write_x</b>
<i>--scattered=RD --in=IF</i> [<i>--16</i>] [<i>--32</i>]
[<i>--app-tag=AT</i>] [<i>--bs=BS</i>] [<i>--dld=DLD</i>]
[<i>--dpo</i>] [<i>--fua</i>] [<i>--grpnum=GN</i>]
[<i>--lba=LBA[,LBA...]</i>] [<i>--num=NUM[,NUM...]</i>]
[<i>--offset=OFF[,DLEN]</i>] [<i>--ref-tag=RT</i>]
[<i>--scat-file=SF</i>] [<i>--scat-raw</i>]
[<i>--strict</i>] [<i>--tag-mask=TM</i>]
[<i>--timeout=TO</i>] [<i>--wrprotect=WPR</i>]
<i>DEVICE</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>sg_write_x</b>
<i>--stream=ID --in=IF</i> [<i>--16</i>] [<i>--32</i>]
[<i>--app-tag=AT</i>] [<i>--bs=BS</i>] [<i>--dpo</i>]
[<i>--fua</i>] [<i>--grpnum=GN</i>] [<i>--lba=LBA</i>]
[<i>--num=NUM</i>] [<i>--offset=OFF[,DLEN]</i>]
[<i>--ref-tag=RT</i>] [<i>--strict</i>]
[<i>--tag-mask=TM</i>] [<i>--timeout=TO</i>]
[<i>--wrprotect=WPR</i>] <i>DEVICE</i></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This utility
will send one of six SCSI commands, all associated with
writing data to the given <i>DEVICE</i>. They are a
&quot;normal&quot; WRITE, ORWRITE, WRITE ATOMIC, WRITE SAME,
WRITE SCATTERED or WRITE STREAM. This utility supports the
16 and 32 byte variants of all six commands. Hence some
closely related commands are not supported (e.g. WRITE(10)).
All 32 byte variants, apart from ORWRITE(32), require the
<i>DEVICE</i> to be formatted with type 1, 2 or 3 Protection
Information (PI), making all logical blocks 8 bytes (or a
multiple of 8 bytes) longer on the media.</p>

<p style="margin-left:11%; margin-top: 1em">The command
line interface is a little crowded with over thirty options.
Hence the SYNOPSIS, after listing all the (long) options,
lists those applicable to each supported command. For each
command synopsis, the option that selects the SCSI command
is shown first followed by any required options. If no
command option is given then a &quot;normal&quot; WRITE is
assumed. Even though the <i>--scat-file=SF</i> option can be
given for every command, it is only shown for WRITE
SCATTERED where it is most useful. If the
<i>--scat-file=SF</i> option is given then neither the
<i>--lba=LBA[,LBA...]</i> nor the <i>--num=NUM[,NUM...]</i>
options should be given. Only the first item of the
<i>--lba=LBA[,LBA...]</i> and the <i>--num=NUM[,NUM...]</i>
options (or first pair (or quintet) from the
<i>--scat-file=SF</i> option) is used for all but the WRITE
SCATTERED command. All commands can take <i>--dry-run</i>
and <i>--verbose</i> in addition to those shown in the
SYNOPSIS.</p>

<p style="margin-left:11%; margin-top: 1em">The logical
block size in bytes can be given explicitly with the
<i>--bs=BS</i> option, as long as <i>BS</i> is greater than
zero. It is typically a power of two, 512 or greater. If the
<i>--bs=BS</i> option is not given or <i>BS</i> is zero then
the SCSI READ CAPACITY command is used to find the logical
block size. First the READ CAPACITY(16) command is tried and
if successful the logical block size in the response is
typically used as the actual block size for this utility.
The exception is when PROT_EN is set in the response and the
<i>--wrprotect=WPR</i> option is given and non-zero; in
which case 8 (bytes) is added to the logical block size to
yield the actual block size used by this utility. If READ
CAPACITY(16) fails then READ CAPACITY(10) is tried and if
that works then the logical block size in the response is
used as the actual block size.</p>

<p style="margin-left:11%; margin-top: 1em">The number of
bytes this utility will attempt to read from the file named
by <i>IF</i> is the product of the actual block size and the
number_of_blocks (<i>NUM</i> or the sum of <i>NUM</i>
arguments). If less bytes are read from the file <i>IF</i>
and the <i>--strict</i> option is given then this utility
exits with an exit status of SG_LIB_FILE_ERROR. If less
bytes are read from the file <i>IF</i> and the
<i>--strict</i> option is not given then bytes of zero are
substituted for the &quot;missing&quot; bytes and this
utility continues.</p>

<p style="margin-left:11%; margin-top: 1em">Attempts to
write multi megabyte data with a single command are likely
to fail for one of several reasons. First the operating
system might object to allocating a buffer that large. Next
the SCSI pass-through usually limits data blocks to a few
megabytes or less. Finally the storage device might have a
limited amount of RAM to support a write operation such as
atomic (as it may need to roll back). The storage device can
inform the application client of its limitations via the
block limits VPD page (0xb0), with the maximum atomic
transfer length field amongst others.</p>

<p style="margin-left:11%; margin-top: 1em">A degenerate
LBA (Logical Block Address) range descriptor with no PI has
an LBA and NUM of zero. A degenerate LBA range descriptor
with PI additionally has its RT, AT and TM fields set to
zero (note: that is not the default values for RT, AT and
TM). They are degenerate in the sense that they are
indistinguishable from a pad of zeros that follow the
scatter list in the data-out buffer. SBC-4 makes clear that
a degenerate LBA range descriptor is valid. This may become
an issue if <i>RD</i> given in the <i>--scattered=RD</i>
option has the value 0. In this case the logic may need to
scan the user provided data to calculate the number of LBA
range descriptors which is required by the WRITE SCATTERED
cdb. In the absence of other information the logic will take
a degenerate LBA range descriptor as a terminator of the
scatter list.</p>

<p style="margin-left:11%; margin-top: 1em">The current
reference for these commands is draft SBC-4 (T10/BSR INCITS
506) revision 15 dated 9 November 2017. All six SCSI
commands are described in that document. WRITE ATOMIC was
added in SBC-4 revision 3; WRITE STREAM was added in SBC-4
revision 7; WRITE SCATTERED was added in SBC-4 revision 11
while the others are in the SBC-3 standard.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Arguments to
long options are mandatory for short options as well. The
options are arranged in alphabetical order based on the long
option name. <b><br>
-6</b>, <b>--16</b></p>

<p style="margin-left:22%;">send the 16 byte cdb variant of
the selected SCSI command. If no command is selected then
the (normal) SCSI WRITE(16) command is sent. If neither this
option nor the <i>--32</i> option is given then this option
is assumed.</p>

<p style="margin-left:11%;"><b>-3</b>, <b>--32</b></p>

<p style="margin-left:22%;">send the 32 byte cdb variant of
the selected SCSI command. If no command is selected then
the (normal) SCSI WRITE(32) command is sent. If neither this
option nor the <i>--16</i> option is given then then the
<i>--16</i> option is assumed. If both this option and the
<i>--16</i> option are given then this option takes
precedence. Note that apart from ORWRITE(32) all other 32
byte cdb variants require a <i>DEVICE</i> formatted with
type 1, 2 or 3 protection information.</p>

<p style="margin-left:11%;"><b>-a</b>,
<b>--app-tag</b>=<i>AT</i></p>

<p style="margin-left:22%;">where <i>AT</i> is the
&quot;expected logical block application tag&quot; field
found in most of the 32 byte cdb variants (the exception is
ORWRITE(32)). <i>AT</i> is a 16 bit field which means the
maximum value is 0xffff. The default value is 0xffff .</p>

<p style="margin-left:11%;"><b>-A</b>,
<b>--atomic</b>=<i>AB</i></p>

<p style="margin-left:22%;">selects the WRITE ATOMIC
command and <i>AB</i> is placed in the Atomic Boundary field
of its cdb. It is a 16 bit field so the maximum value is
0xffff. If unsure what value to set, try 0 which will
attempt to write the whole data-out buffer in a single
atomic operation.</p>

<p style="margin-left:11%;"><b>-B</b>,
<b>--bmop</b>=<i>OP,PGP</i></p>

<p style="margin-left:22%;">where <i>OP</i> and <i>PGP</i>
are the values to be placed in ORWRITE(32)&rsquo;s BMOP and
&rsquo;Previous Generation Processing&rsquo; fields
respectively. BMOP is a 3 bit field (ranges from 0 to 7) and
PGP is a 4 bit field (ranges from 0 to 15). Both fields
default to 0.</p>

<p style="margin-left:11%;"><b>-b</b>,
<b>--bs</b>=<i>BS</i></p>

<p style="margin-left:22%;">where <i>BS</i> is the logical
block size or the actual block size which will be slightly
bigger. The default value is zero. If this option is not
given or is given with a <i>BS</i> of zero then the SCSI
READ CAPACITY(16) command is sent to <i>DEVICE</i>. If that
fails then the READ CAPACITY(10) command is sent. The
logical and actual block size will be derived from the
response of the READ CAPACITY command. <br>
This section assumes <i>BS</i> is greater than zero. If
<i>BS</i> is less than 512 (bytes) or not a multiple of 8, a
warning is issued and the utility continues unless the
<i>--strict</i> option is also given. If <i>BS</i> is a
power of two (e.g. 512) then the logical and actual block
size is set to <i>BS</i> (e.g. 512). If <i>BS</i> is not a
power of two (e.g. 520) then the logical block size is set
to the closest power of two less than <i>BS</i> (e.g. 512)
and the actual block size is set to <i>BS</i> (e.g. 520).
<br>
If the logical and actual block size are different then a
later check will reduce the actual block size back to the
logical block size unless <i>--wrprotect=WPR</i> is greater
than zero.</p>

<p style="margin-left:11%;"><b>-c</b>,
<b>--combined</b>=<i>DOF</i></p>

<p style="margin-left:22%;">This option only applies to
WRITE SCATTERED and assumes the whole data-out buffer can be
read from <i>IF</i> given by the <i>--in=IF</i> option. The
whole data-out buffer is the parameter list header, followed
by zero or more LBA range descriptors, optionally followed
by some pad bytes and then the data to be written to the
media. If the <i>--lba=LBA[,LBA...]</i>,
<i>--num=NUM[,NUM...]</i> or <i>--scat-file=SF</i> options
are also given then an error is generated. The <i>DOF</i>
argument should be the value suitable for the &rsquo;Logical
Block Data Offset&rsquo; field in the WRITE SCATTERED cdb.
This is the offset in the data-out buffer where the data to
write to the media commences. The unit of that field is the
actual block size which is the logical block size plus a
multiple of 8, if protection information (PI) is being sent.
When <i>WPR</i> (from <i>--wrprotect=WPR</i>) is greater
than zero then PI is expected. SBC-4 revision 15 does not
state it but it would appear that a <i>DOF</i> value of 0 is
invalid. It is suggested that this option be used with the
<i>--strict</i> option while experimenting as random or
incorrect data fed in via the <i>--in=IF</i> option could
write a lot of &quot;interesting&quot; data all over the
<i>DEVICE</i>. If <i>DOF</i> is given as 0 the utility will
scan the data in <i>IF</i> until <i>RD</i> LBA range
descriptors are found; or if <i>RD</i> is also 0 until a
degenerate LBA range descriptor is found.</p>

<p style="margin-left:11%;"><b>-D</b>,
<b>--dld</b>=<i>DLD</i></p>

<p style="margin-left:22%;">where <i>DLD</i> is the
duration limits descriptor spread across 3 bits in the SCSI
WRITE(16) and the WRITE SCATTERED(16) cdbs. <i>DLD</i> is
between 0 to 7 inclusive with a default of zero. The DLD0
field in WRITE(16) and WRITE SCATTERED(16) is set if (0x1
&amp; <i>DLD</i>) is non-zero. The DLD1 field in both cdbs
is set if (0x2 &amp; <i>DLD</i>) is non-zero. The DLD2 field
in both cdbs is set if (0x4 &amp; <i>DLD</i>) is
non-zero.</p>

<p style="margin-left:11%;"><b>-d</b>, <b>--dpo</b></p>

<p style="margin-left:22%;">if this option is given then
the DPO (disable page out) bit field in the cdb is set. The
default is to clear this bit field. Applies to all commands
supported by thus utility except WRITE SAME.</p>

<p style="margin-left:11%;"><b>-x</b>, <b>--dry-run</b></p>

<p style="margin-left:22%;">this option exits (with a
status of 0) just before it would otherwise send the
selected SCSI write command. It may still send a SCSI READ
CAPACITY command (16 byte variant and perhaps 10 byte
variant as well) so the <i>DEVICE</i> is still required. It
reads the data in and processes it if the <i>--in=IF</i>
and/or the <i>--scat-file=SF</i> options are given. All
command line processing and sanity checks (e.g. if the
<i>--strict</i> option is given) will be performed and if
there is an error then there will be a non zero exit status
value. <br>
If this option is given twice (e.g. -xx) then instead of
performing the selected write SCSI command, the data-out
buffer is written to a file called sg_write_x.bin . If it
doesn&rsquo;t exist then that file is created in the current
directory and is truncated if it previously did exist with
longer contents. The data-out buffer is written in binary
with some information about it written to stdout. For writes
other than scattered the filename and its length in bytes is
output to stdout. For write scattered additionally its
number of LBA range descriptors and its logical block data
offset written to stdout.</p>

<p style="margin-left:11%;"><b>-f</b>, <b>--fua</b></p>

<p style="margin-left:22%;">if this option is given then
the FUA (force unit access) bit field in the cdb is set. The
default is to clear this bit field. Applies to all commands
supported by thus utility except WRITE SAME.</p>

<p style="margin-left:11%;"><b>-G</b>,
<b>--generation</b>=<i>EOG,NOG</i></p>

<p style="margin-left:22%;">the arguments for this option
are used by the ORWITE(32) command only. <i>EOG</i> is
placed in the &quot;Expected ORWgeneration&quot; field while
<i>NOG</i> is placed in the &quot;New ORWgeneration&quot;
field. Both are 32 bits long and default to zero.</p>

<p style="margin-left:11%;"><b>-g</b>,
<b>--grpnum</b>=<i>GN</i></p>

<p style="margin-left:22%;">sets the &rsquo;Group
number&rsquo; field to <i>GN</i>. Defaults to a value of
zero. <i>GN</i> should be a value between 0 and 63.</p>

<p style="margin-left:11%;"><b>-h</b>, <b>--help</b></p>

<p style="margin-left:22%;">output the usage message then
exit. Use multiple times for more help. Currently
&rsquo;-h&rsquo; to &rsquo;-hhhh&rsquo; provide different
output.</p>

<p style="margin-left:11%;"><b>-i</b>,
<b>--in</b>=<i>IF</i></p>

<p style="margin-left:22%;">read data (in binary) from a
file named <i>IF</i> in a single OS system call (in Unix:
read(2)). That data is placed in a continuous buffer and
then used as the data-out buffer for all SCSI write commands
apart from WRITE SCATTERED(16 or 32) which may include other
data in the data-out buffer. For WRITE SCATTERED (16 or 32)
the data-out buffer is made up of 3 or 4 components in this
order: a parameter list header (32 zero bytes); zero or more
LBA range descriptors, optionally some pad bytes (zeros) and
then data to write to the media. For WRITE SCATTERED
<i>IF</i> only provides the data to write to the media
unless <i>--combined=DOF</i> is given. When the
<i>--combined=DOF</i> option is given <i>IF</i> contains all
components of the WRITE SCATTERED data-out buffer in binary.
The data read from <i>IF</i> starts from byte offset
<i>OFF</i> which defaults to zero and no more than
<i>DLEN</i> bytes are read from that point (i.e. from the
file byte offset <i>OFF</i>). If <i>DLEN</i> is zero or not
given the rest of the file <i>IF</i> is read. This option is
mandatory apart from when --same=1 is given (that sets the
NDOB bit which stands for &quot;No Data Out Buffer&quot;).
In Unix based OSes, any number of zeros can be produced by
using the /dev/zero device file. <i><br>
IF</i> may be &quot;-&quot; which is taken as stdin. In this
case the <i>--offset=OFF,DLEN</i> can be given with
<i>OFF</i> set to 0 and <i>LEN</i> set to a non-zero value,
preferably a multiple of the actual block size. The utility
can also deduce how long the <i>IF</i> should be from
<i>NUM</i> (or the sum of them in the case of a scatter
list).</p>

<p style="margin-left:11%;"><b>-l</b>,
<b>--lba</b>=<i>LBA[,LBA...]</i></p>

<p style="margin-left:22%;">where the argument is a single
Logical Block Address (LBA) or a comma separated list of
<i>LBA</i>s each of which is the address of the first block
written by the selected write command. Only the WRITE
SCATTERED command can usefully take more than one
<i>LBA</i>. Whatever number of <i>LBA</i>s is given, there
needs to be an equal number of <i>NUM</i>s given to the
<i>--num=NUM[,NUM...]</i> option. The first given <i>LBA</i>
joins with the first given <i>NUM</i> to form the first LBA
range descriptor (which T10 number from zero in SBC-4). The
second <i>LBA</i> joins with the second <i>LBA</i> to form
the second LBA range descriptor, etc. A more convenient way
to define a large number of LBA range descriptors is with
the <i>--scat-file=SF</i> option. Defaults to logical block
0 (which could be dangerous) while <i>NUM</i> defaults to 0
which makes the combination harmless. <i>LBA</i> is assumed
to be in decimal unless prefixed with &rsquo;0x&rsquo; or
has a trailing &rsquo;h&rsquo;.</p>

<p style="margin-left:11%;"><b>-N</b>, <b>--normal</b></p>

<p style="margin-left:22%;">the choice of a
&quot;normal&quot; WRITE (16 or 32) command can be made
explicitly with this option. In the absence of selecting any
other command (e.g. <i>--atomic=AB</i> ), the choice of a
&quot;normal&quot; WRITE is the default.</p>

<p style="margin-left:11%;"><b>-n</b>,
<b>--num</b>=<i>NUM[,NUM...]</i></p>

<p style="margin-left:22%;">where the argument is a single
NUMber of blocks (NUM) or a comma separated list of
<i>NUM</i>s that pair with the corresponding entries in the
<i>--lba=LBA[,LBA...]</i> option. If a <i>NUM</i> is given
and is not provided by another method (e.g. by using the
<i>--scat-file=SF</i> option) then it defaults to the number
of blocks derived from the size of the file named by
<i>IF</i> (starting at byte offset <i>OFF</i> to the end or
the file or <i>DLEN</i>). Apart from the
<i>--combined=DOF</i> option, an LBA must be explicitly
given (either with <i>I--lba=LBA</i> or via
<i>--scat-file=SF</i>), if not <i>NUM</i> defaults to 0 as a
safety measure.</p>

<p style="margin-left:11%;"><b>-o</b>,
<b>--offset</b>=<i>OFF[,DLEN]</i></p>

<p style="margin-left:22%;">where <i>OFF</i> is the byte
offset within the file named <i>IF</i> to start reading
from. The default value of <i>OFF</i> is zero which is the
beginning of file named <i>IF</i>. <i>DLEN</i> is the
maximum number of bytes to read, starting at byte offset
<i>OFF</i>, from the file named <i>IF</i>. Less bytes will
be read if an end of file occurs before <i>DLEN</i> is
exhausted. If <i>DLEN</i> is zero or not given then reading
from byte offset <i>OFF</i> to the end of the file named
<i>IF</i> is assumed.</p>

<p style="margin-left:11%;"><b>-O</b>, <b>--or</b></p>

<p style="margin-left:22%;">selects the ORWRITE command.
ORWRITE(16) has similar fields to WRITE(16) apart from the
WRPROTECT field being named ORPROTECT with slightly
different semantics and the absence of the 3 DLD bit fields.
ORWRITE(32) has four extra fields that are set with the
<i>--bmop=OP,PGP</i> and <i>--generation=EOG,NOG</i>
options. ORWRITE(32) is the only 32 byte cdb command in this
utility that does not require a <i>DEVICE</i> formatted with
type 1, 2 or 3 PI (although it will still work if it is
formatted with PI).</p>

<p style="margin-left:11%;"><b>-Q</b>, <b>--quiet</b></p>

<p style="margin-left:22%;">suppress some informational
messages such as the ones associated with detected errors
when this utility is about to exit. The exit status value is
still returned to the operating system when this utility
exits.</p>

<p style="margin-left:11%;"><b>-r</b>,
<b>--ref-tag</b>=<i>RT</i></p>

<p style="margin-left:22%;">where <i>RT</i> is the
&quot;expected initial logical block reference tag&quot;
field found in the 32 byte cdb variants of WRITE, WRITE
ATOMIC, WRITE SAME and WRITE STREAM. The field is also found
in the WRITE SCATTERED(32) LBA range descriptors. It is a 32
bit field which means the maximum value is 0xffffffff. The
default value is 0xffffffff.</p>

<p style="margin-left:11%;"><b>-S</b>,
<b>--same</b>=<i>NDOB</i></p>

<p style="margin-left:22%;">selects the WRITE SAME command
with the NDOB field set to <i>NDOB</i> which stands for No
Data-Out Buffer. <i>NDOB</i> can take values 0 or 1 (i.e. it
is a single bit field). When --same=1 all options associated
with the data-out buffer are ignored.</p>

<p style="margin-left:11%;"><b>-q</b>,
<b>--scat-file</b>=<i>SF</i></p>

<p style="margin-left:22%;">where <i>SF</i> is the name of
an auxiliary file containing the scatter list for the WRITE
SCATTERED command. If the <i>--scat-raw</i> option is also
given then <i>SF</i> is assumed to contain both the
parameter list header (32 bytes of zeros) followed by zero
or more LBA range descriptors which are also 32 bytes long
each. These components are as defined by SBC-4 (i.e. in
binary with integers in big endian format). If the
<i>--scat-raw</i> option is not given then a file of ACSII
hexadecimal is expected as described in the SCATTERED FILE
ASCII FORMAT section below. <br>
If this option is given with the <i>--combined=DOF</i>
option then this utility will exit with a syntax error.
<i>SF</i> must not be &quot;-&quot;, a way of stopping the
user trying to redirect stdin.</p>

<p style="margin-left:11%;"><b>-R</b>,
<b>--scat-raw</b></p>

<p style="margin-left:22%;">this option only effects the
way that the file named <i>SF</i> from the
<i>--scat-file=SF</i> option for WRITE SCATTERED is
interpreted. By default (i.e. without this option),
<i>SF</i> is parsed as ASCII hexadecimal with blank lines
and line contents from and including &rsquo;#&rsquo; to the
end of line ignored. Hence it can contain comments and other
indications. When this option is given, the file named
<i>SF</i> is interpreted as binary. As binary it is assumed
to contain 32 bytes of zeros (the WRITE SCATTERED parameter
list header) followed by zero or more LBA range descriptors
(which are 32 bytes each). If the <i>--strict</i> option is
given the reserved field in those two items are checked with
any non zero bytes causing an error.</p>

<p style="margin-left:11%;"><b>-S</b>,
<b>--scattered</b>=<i>RD</i></p>

<p style="margin-left:22%;">selects the WRITE SCATTERED
command with <i>RD</i> being the number of LBA range
descriptors that will be placed in the data-out buffer. If
<i>RD</i> is zero then the logic will try and determine the
number of range descriptors by other means (e.g. by parsing
the file named by <i>SF</i>, if there is one). The LBA range
descriptors differ between the 16 and 32 byte cdb variants
of WRITE SCATTERED. In the 16 byte cdb variant the 32 byte
LBA range descriptor is made up of an 8 byte LBA, followed
by a 4 byte number_of_blocks followed by 20 bytes of zeros.
In the 32 byte variant the LBA and number_of_blocks are
followed by a RT (4 bytes), an AT (2 bytes) and a TM (2
bytes) then 12 bytes of zeros. <br>
This paragraph applies when <i>RD</i> is greater than zero.
If <i>RD</i> is less than the number of LBA range
descriptors built from command line options, from the
<i>--scat-file=SF</i> option or decoded from <i>IF</i> (when
the <i>--combined=DOF</i> option is given) then <i>RD</i>
takes precedence; so <i>RD</i> is placed in the &quot;Number
of LBA Range Descriptors&quot; field in the cdb. If
<i>RD</i> is greater than the number of LBA range
descriptors found from the provided data and options, then
an error is generated.</p>

<p style="margin-left:11%;"><b>-T</b>,
<b>--stream</b>=<i>ID</i></p>

<p style="margin-left:22%;">selects the WRITE STREAM
command with the STR_ID field set to <i>ID</i>. <i>ID</i>
can take values from 0 to 0xffff (i.e. it is a 16 bit
field).</p>

<p style="margin-left:11%;"><b>-s</b>, <b>--strict</b></p>

<p style="margin-left:22%;">when this option is present,
more things (e.g. that reserved fields contain zeros) and
any irregularities will terminate the utility with a message
to stderr and an indicative exit status. While experimenting
with these commands, especially WRITE SCATTERED, it is
recommended to use this option.</p>

<p style="margin-left:11%;"><b>-t</b>,
<b>--tag-mask</b>=<i>TM</i></p>

<p style="margin-left:22%;">where <i>TM</i> is the
&quot;logical block application tag mask&quot; field found
in the 32 byte cdb variants of WRITE, WRITE ATOMIC, WRITE
SAME and WRITE STREAM. The field is also found in the WRITE
SCATTERED(32) LBA range descriptors. It is a 16 bit field
which means the maximum value is 0xffff. The default value
is 0xffff.</p>

<p style="margin-left:11%;"><b>-I</b>,
<b>--timeout</b>=<i>TO</i></p>

<p style="margin-left:22%;">where <i>TO</i> is the command
timeout value in seconds. The default value is 120 seconds.
If <i>NUM</i> is large on slow media then these WRITE
commands may require considerably more time than 120 seconds
to complete.</p>

<p style="margin-left:11%;"><b>-u</b>,
<b>--unmap</b>=<i>U_A</i></p>

<p style="margin-left:22%;">where <i>U_A</i> is OR-ed bit
values used to set the UNMAP and ANCHOR bit fields in the
WRITE SAME (16 or 32) cdb. If <i>U_A</i> is 1 then the UNMAP
bit field is set; if <i>U_A</i> is 2 then the ANCHOR bit
field is set; if <i>U_A</i> is 3 then both the UNMAP and
ANCHOR bit fields are set. The default value for both bit
fields is clear (0); setting <i>U_A</i> to 0 will also clear
both bit fields.</p>

<p style="margin-left:11%;"><b>-v</b>, <b>--verbose</b></p>

<p style="margin-left:22%;">increase the degree of
verbosity (debug messages). These messages are usually
written to stderr.</p>

<p style="margin-left:11%;"><b>-V</b>, <b>--version</b></p>

<p style="margin-left:22%;">output version string then
exit.</p>

<p style="margin-left:11%;"><b>-w</b>,
<b>--wrprotect</b>=<i>WPR</i></p>

<p style="margin-left:22%;">sets the WRPROTECT field (3
bits) in all sg_write_x commands apart from ORWRITE which
has a 3 bit ORPROTECT field (and the synopsis shows OPR to
highlight the difference). In all cases <i>WPR</i> is placed
in that 3 bit field. The default value is zero which does
not send any PI in the data-out buffer. <i>WPR</i> should be
a value between 0 and 7.</p>

<h2>SCATTERED FILE ASCII FORMAT
<a name="SCATTERED FILE ASCII FORMAT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">All commands in
this utility can take a <i>--scat-file=SF</i> and that
option can be seen as a replacement for the
<i>--lba=LBA[,LBA...]</i> and <i>--num=NUM[,NUM...]</i>
options. if both the <i>--scat-file=SF</i> and
<i>--scat-raw</i> options are given then the file named
<i>SF</i> is expected to be binary and contain the parameter
list header (32 bytes of zeros for both the 16 and 32 byte
variants) followed by zero or more LBA range descriptors,
each of 32 bytes each. This section describes what is
expected in <i>SF</i> when the <i>--scat-raw</i> option is
not given.</p>

<p style="margin-left:11%; margin-top: 1em">The ASCII
hexadecimal &quot;scatter file&quot; (named by <i>SF</i>)
can contain comments, empty lines and numbers. If multiple
numbers appear on one line they can be separated by spaces,
tabs or a single comma. Numbers are parsed as decimal unless
prefixed by &quot;0x&quot; (or &quot;0X&quot;) or have a
suffix of &quot;h&quot;. Ox is the prefix of hexadecimal
number is the C language while T10 uses the &quot;h&quot;
suffix for the same purpose. Anything from and including a
&quot;#&quot; character to the end-of-line is ignored, so
comments can be placed there.</p>

<p style="margin-left:11%; margin-top: 1em">For the WRITE
SCATTERED (16) command, its LBA range descriptors contain
two items per descriptor: an 8 byte LBA followed by a 4 byte
number_of_blocks. The remaining 20 bytes of the descriptor
are zeros. The format accepted is relatively loose with each
decoded value being placed in an LBA and then a
number_of_blocks until the end-of-file is reached. The
pattern starts with a LBA and if it doesn&rsquo;t finish
with a number_of_blocks (i.e. an odd number of values are
parsed) an error occurs. So the number of LBA range
descriptors generated will be half the number of values
parsed in <i>SF</i>.</p>

<p style="margin-left:11%; margin-top: 1em">For the WRITE
SCATTERED (32) command, its LBA range descriptors contain
five items per descriptor: an 8 byte LBA followed by a 4
byte number_of_blocks, then a 4 byte RT, a 2 byte AT, and a
2 byte TM. The last three items are associated with
protection information (PI). The accepted format in the
<i>SF</i> file is more constrained than the 16 byte cdb
variant. The items for each LBA range descriptor must be
found on one line with adjacent items being comma separated.
The first two items (LBA and number_of_blocks) must be
given, and if no more items are on the line then RT, AT and
TM are given their default values (all &quot;ff&quot;
bytes). Spaces and tabs may appear between items but commas
are the separators. Two commas with no value between them
will cause the &quot;missing&quot; item to receive its
default value.</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Various numeric
arguments (e.g. <i>LBA</i>) may include multiplicative
suffixes or be given in hexadecimal. See the &quot;NUMERIC
ARGUMENTS&quot; section in the sg3_utils(8) man page.</p>

<p style="margin-left:11%; margin-top: 1em">In Linux, prior
to lk 3.17, the sg driver did not support cdb sizes greater
than 16 bytes. Hence a device node like /dev/sg1 which is
associated with the sg driver would fail with this utility
if the <i>--32</i> option was given (or implied by other
options). The bsg driver with device nodes like
/dev/bsg/6:0:0:1 does support cdb sizes greater than 16
bytes since its introduction in lk 2.6.28 .</p>

<h2>EXIT STATUS
<a name="EXIT STATUS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The exit status
of sg_write_x is 0 when it is successful. Otherwise see the
sg3_utils(8) man page.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">One simple
usage is to write 4 blocks of zeros from (and including) a
given LBA according to the rules of WRITE ATOMIC with an
atomic boundary of 0. Since no cdb size option is given, the
16 byte cdb will be assumed (i.e. WRITE ATOMIC(16)):</p>

<p style="margin-left:11%; margin-top: 1em">sg_write_x
--atomic=0 --in=/dev/zero --lba=0x1234 --num=4 /dev/sdc</p>

<p style="margin-left:11%; margin-top: 1em">Since
<i>--bs=BS</i> has not been given, then this utility will
call the READ CAPACITY(16) command on /dev/sdc to determine
the number of bytes in a logical block. If the READ
CAPACITY(16) command fails then the READ CAPACITY(10)
command is tried. Let us assume one of them works and that
the number of bytes in each logical block is 512 bytes. So 4
blocks of zeros (each block containing 512 bytes) will be
written from (and including) LBA 0x1234 . Now to bypass the
need for the READ CAPACITY command(s) the <i>--bs=BS</i>
option can be used:</p>

<p style="margin-left:11%; margin-top: 1em">sg_write_x
--atomic=0 --bs=512 --in=/dev/zero --lba=0x1234 --num=4
/dev/sdc</p>

<p style="margin-left:11%; margin-top: 1em">Since --bs= is
given and its value (512) is a power of 2, then the actual
block size is also 512. If instead 520 was given then the
logical block size would be 512 (the highest power of 2 less
than 520) and the actual block size would be 520 bytes. To
send the 32 byte variant add --32 as in:</p>

<p style="margin-left:11%; margin-top: 1em">sg_write_x
--atomic=0 --32 --bs=512 --in=/dev/zero --lba=0x1234 --num=4
/dev/sdc</p>

<p style="margin-left:11%; margin-top: 1em">To send a WRITE
STREAM(32) with a STR_ID of 1 use the following:</p>

<p style="margin-left:11%; margin-top: 1em">sg_write_x
--stream=1 --32 --bs=512 --in=/dev/zero --lba=0x1234 --num=4
/dev/sdc</p>

<p style="margin-left:11%; margin-top: 1em">Next is a WRITE
SCATTERED(16) command with the scatter list, split between
the --lba= and --num= options, on the command line:</p>

<p style="margin-left:11%; margin-top: 1em">sg_write_x
--scattered=2 --lba=2,0x33 --num=4,1 -i /dev/zero
/dev/sg1</p>

<p style="margin-left:11%; margin-top: 1em">Example of a
WRITE SCATTERED(16) command with a degenerate LBA range
descriptor (first element to --lba= and --num=):</p>

<p style="margin-left:11%; margin-top: 1em">sg_write_x
--scattered=2 --lba=0,0x33 --num=0,1 -i /dev/zero
/dev/sg1</p>

<p style="margin-left:11%; margin-top: 1em">Example of a
WRITE SCATTERED(16) command with the scatter list in
scat_file.txt</p>

<p style="margin-left:11%; margin-top: 1em">sg_write_x
--scattered=3 -q scat_file.txt -i /dev/zero /dev/sg1</p>

<p style="margin-left:11%; margin-top: 1em">Next a WRITE
SCATTERED(16) command with its scatter list and data in a
single file. Note that the argument to --scattered= is 0 so
the number of LBA range descriptors is calculated by
analyzing the first two blocks of scat_data.bin (because the
argument to --combined= is 2) :</p>

<p style="margin-left:11%; margin-top: 1em">sg_write_x
--scattered=0 --combined=2 -i scat_data.bin /dev/sg1</p>

<p style="margin-left:11%; margin-top: 1em">When the -xx
option is used, a WRITE SCATTERED command is not executed
but instead the contents of the data-out buffer are written
to a file called sg_write_x.bin . In the case of WRITE
SCATTERED that binary file is suitable for supplying to a
later invocation to do the actual write to media. For
example:</p>

<p style="margin-left:11%; margin-top: 1em">sg_write_x
--scattered=3 -q scat_file.txt -xx -i /dev/zero /dev/sg1
<br>
Wrote 8192 bytes to sg_write_x.bin, LB data offset: 1 <br>
Number of LBA range descriptors: 3 <br>
sg_write_x --scattered=0 --combined=1 -i sg_write_x.bin
/dev/sg1</p>

<p style="margin-left:11%; margin-top: 1em">Notice when the
sg_write_x.bin is written (and nothing is written to the
media), a summary of what has happened is sent to stdout.
The value shown for &quot;LB data offset:&quot; (1) should
be given to the --combined= option when the write to media
actually occurs (i.e. the second invocation shown directly
above).</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Written by
Douglas Gilbert.</p>

<h2>REPORTING BUGS
<a name="REPORTING BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Report bugs to
&lt;dgilbert at interlog dot com&gt;.</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Copyright
&copy; 2017 Douglas Gilbert <br>
This software is distributed under a FreeBSD license. There
is NO warranty; not even for MERCHANTABILITY or FITNESS FOR
A PARTICULAR PURPOSE.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>sg_readcap,sg_vpd,sg_write_same,sg_stream_ctl(sg3_utils)</b></p>
<hr>
</body>
</html>
