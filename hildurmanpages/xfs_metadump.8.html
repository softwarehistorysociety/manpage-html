<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Thu Sep  8 03:14:54 2022 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>xfs_metadump</title>

</head>
<body>

<h1 align="center">xfs_metadump</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#DIAGNOSTICS">DIAGNOSTICS</a><br>
<a href="#NOTES">NOTES</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#BUGS">BUGS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">xfs_metadump -
copy XFS filesystem metadata to a file</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>xfs_metadump</b>
[ <b>-aefFgow</b> ] [ <b>-m</b> <i>max_extents</i> ] ] [
<b>-l</b> <i>logdev</i> ] <i>source target</i> <b><br>
xfs_metadump -V</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>xfs_metadump</b>
is a debugging tool that copies the metadata from an XFS
filesystem to a file. The <i>source</i> argument must be the
pathname of the device or file containing the XFS filesystem
and the <i>target</i> argument specifies the destination
file name. If <i>target</i> is -, then the output is sent to
stdout. This allows the output to be redirected to another
program such as a compression application.</p>


<p style="margin-left:11%; margin-top: 1em"><b>xfs_metadump</b>
may only be used to copy unmounted filesystems, or read-only
mounted filesystems.</p>


<p style="margin-left:11%; margin-top: 1em"><b>xfs_metadump</b>
does not alter the source filesystem in any way. The
<i>target</i> image is a contiguous (non-sparse) file
containing all the filesystem&rsquo;s metadata and indexes
to where the blocks were copied from.</p>

<p style="margin-left:11%; margin-top: 1em">By default,
<b>xfs_metadump</b> obfuscates most file (regular file,
directory and symbolic link) names and extended attribute
names to allow the dumps to be sent without revealing
confidential information. Extended attribute values are
zeroed and no data is copied. The only exceptions are file
or attribute names that are 4 or less characters in length.
Also file names that span extents (this can only occur with
the <b>mkfs.xfs</b>(8) options where <b>-n</b> <i>size</i>
&gt; <b>-b</b> <i>size</i>) are not obfuscated. Names
between 5 and 8 characters in length inclusively are
partially obfuscated.</p>


<p style="margin-left:11%; margin-top: 1em"><b>xfs_metadump</b>
cannot obfuscate metadata in the filesystem log. Log
recovery of an obfuscated metadump image may expose
clear-text metadata and/or cause filesystem corruption in
the restored image. It is recommended that the source
filesystem first be mounted and unmounted, if possible, to
ensure that the log is clean. A subsequent invocation of
<b>xfs_metadump</b> will capture a clean log and obfuscate
all metadata correctly.</p>

<p style="margin-left:11%; margin-top: 1em">If a metadump
must be produced from a filesystem with a dirty log, it is
recommended that obfuscation be turned off with -o option,
if metadata such as filenames is not considered sensitive.
If obfuscation is required on a metadump with a dirty log,
please inform the recipient of the metadump image about this
situation.</p>


<p style="margin-left:11%; margin-top: 1em"><b>xfs_metadump</b>
should not be used for any purposes other than for debugging
and reporting filesystem problems. The most common usage
scenario for this tool is when <b>xfs_repair</b>(8) fails to
repair a filesystem and a metadump image can be sent for
analysis.</p>

<p style="margin-left:11%; margin-top: 1em">The file
generated by <b>xfs_metadump</b> can be restored to
filesystem image (minus the data) using the
<b>xfs_mdrestore</b>(8) tool.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em"><b>-a</b></p></td>
<td width="8%"></td>
<td width="78%">


<p style="margin-top: 1em">Copies entire metadata blocks.
Normally, <b>xfs_metadump</b> will zero any stale bytes
interspersed with in-use metadata. Use this option to copy
full metadata blocks, to provide more debugging information
for a corrupted filesystem. Note that the extra data will be
unobfuscated.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-e</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Stops the dump on a read error. Normally, it will ignore
read errors and copy all the metadata that is
accessible.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-f</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Specifies that the filesystem image to be processed is
stored in a regular file (see the <b>mkfs.xfs -d</b> file
option). This can also happen if an image copy of a
filesystem has been made into an ordinary file with
<b>xfs_copy</b>(8).</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-F</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Specifies that we want to continue even if the
superblock magic is not correct. If the source is truly not
an XFS filesystem, the resulting image will be useless, and
xfs_metadump may crash.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-g</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Shows dump progress. This is sent to stdout if the
<i>target</i> is a file or to stderr if the <i>target</i> is
stdout.</p> </td></tr>
</table>

<p style="margin-left:11%;"><b>-l</b> <i>logdev</i></p>

<p style="margin-left:22%;">For filesystems which use an
external log, this specifies the device where the external
log resides. The external log is not copied, only internal
logs are copied.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-m</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Set the maximum size of an allowed metadata extent.
Extremely large metadata extents are likely to be corrupt,
and will be skipped if they exceed this value. The default
size is 2097151 blocks.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-o</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Disables obfuscation of file names and extended
attributes.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-w</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Prints warnings of inconsistent metadata encountered to
stderr. Bad metadata is still copied.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-V</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Prints the version number and exits.</p></td></tr>
</table>

<h2>DIAGNOSTICS
<a name="DIAGNOSTICS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>xfs_metadump</b>
returns an exit code of 0 if all readable metadata is
successfully copied or 1 if a write error occurs or a read
error occurs and the <b>-e</b> option used.</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">As
<b>xfs_metadump</b> copies metadata only, it does not matter
if the <i>source</i> filesystem has a realtime section or
not. If the filesystem has an external log, it is not
copied. Internal logs are copied and any outstanding log
transactions are not obfuscated if they contain names.</p>


<p style="margin-left:11%; margin-top: 1em"><b>xfs_metadump</b>
is a shell wrapper around the <b>xfs_db</b>(8)
<b>metadump</b> command.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>xfs_repair</b>(8),
<b>xfs_mdrestore</b>(8), <b>xfs_freeze</b>(8),
<b>xfs_db</b>(8), <b>xfs_copy</b>(8), <b>xfs</b>(5)</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Email bug
reports to <b>linux-xfs@vger.kernel.org</b>.</p>
<hr>
</body>
</html>
