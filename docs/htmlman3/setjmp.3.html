<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>setjmp(3) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="setjmp(3) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve">
  </script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>
<body onload="javascript:init()">
  <div class="navheader">
    <table width="100%">
      <tbody>
        <tr>
          <td style="width: 33%" rowspan="1" colspan="1"><a href="../index.html" shape="rect">Linux
          manual pages</a></td>
          <th rowspan="1" colspan="1"><a href="../index3.html" shape="rect">Section 3</a></th>
          <td style="width: 33%" rowspan="1" colspan="1"> </td>
        </tr>
      </tbody>
    </table>
    <hr />
  </div>
  <div class="refentry">
    <a id="setjmp.3" name="setjmp.3" shape="rect"> </a>
    <div class="titlepage"> </div>
    <div class="refnamediv">
      <h2>Name</h2>
      <p>setjmp, sigsetjmp, longjmp, siglongjmp — performing
      a nonlocal goto</p>
    </div>
    <div class="refsynopsisdiv">
      <h2>Synopsis</h2>
      <div class="funcsynopsis">
        <pre class="funcsynopsisinfo" xml:space="preserve">
        #include &lt;setjmp.h&gt;</pre>
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>setjmp</strong>(</code></td>
            <td rowspan="1" colspan="1">jmp_buf <var class="pdparam">env</var><code>)</code>;</td>
          </tr>
        </table>
        <div class="funcprototype-spacer">
           
        </div>
      </div>
      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>sigsetjmp</strong>(</code></td>
            <td rowspan="1" colspan="1">sigjmp_buf <var class="pdparam">env</var>,</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"> </td>
            <td rowspan="1" colspan="1">int <var class="pdparam">savesigs</var><code>)</code>;</td>
          </tr>
        </table>
        <div class="funcprototype-spacer">
           
        </div>
      </div>
      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">void
            <strong>longjmp</strong>(</code></td>
            <td rowspan="1" colspan="1">jmp_buf <var class="pdparam">env</var>,</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"> </td>
            <td rowspan="1" colspan="1">int <var class="pdparam">val</var><code>)</code>;</td>
          </tr>
        </table>
        <div class="funcprototype-spacer">
           
        </div>
      </div>
      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">void
            <strong>siglongjmp</strong>(</code></td>
            <td rowspan="1" colspan="1">sigjmp_buf <var class="pdparam">env</var>,</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"> </td>
            <td rowspan="1" colspan="1">int <var class="pdparam">val</var><code>)</code>;</td>
          </tr>
        </table>
        <div class="funcprototype-spacer">
           
        </div>
      </div>
      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
        <table border="0" summary="Note">
          <tr>
            <td rowspan="2" align="center" valign="top" width="25" colspan="1">
            <img alt="[Note]" src="../stylesheet/note.png" /></td>
            <th align="left" rowspan="1" colspan="1">Note</th>
          </tr>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <div class="featuretests">
                <table style="border-collapse: collapse;">
                  <colgroup span="1">
                    <col span="1" />
                  </colgroup>
                  <thead>
                    <tr>
                      <th style="" rowspan="1" colspan="1">Feature Test Macro Requirements
                      for glibc (see <a class="link" href="../htmlman7/feature_test_macros.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">feature_test_macros</span>(7)</span></a>):</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td style="" rowspan="1" colspan="1"><code class="function">setjmp</code>():</td>
                    </tr>
                    <tr>
                      <td class="featuretestdef" style="" rowspan="1" colspan="1">see
                      NOTES.</td>
                    </tr>
                    <tr>
                      <td style="" rowspan="1" colspan="1"><code class="function">sigsetjmp</code>():</td>
                    </tr>
                    <tr>
                      <td class="featuretestdef" style="" rowspan="1" colspan="1">
                      <code class="constant">_POSIX_C_SOURCE</code></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div class="refsect1">
      <a id="setjmp-3_sect1" name="setjmp-3_sect1" shape="rect"> </a>
      <h2>DESCRIPTION</h2>
      <p>The functions described on this page are used for
      performing "nonlocal gotos": transferring execution from one
      function to a predetermined location in another function. The
      <code class="function">setjmp</code>() function dynamically
      establishes the target to which control will later be
      transferred, and <code class="function">longjmp</code>()
      performs the transfer of execution.</p>
      <p>The <code class="function">setjmp</code>() function saves
      various information about the calling environment (typically,
      the stack pointer, the instruction pointer, possibly the
      values of other registers and the signal mask) in the buffer
      <em class="parameter"><code>env</code></em> for later use by
      <code class="function">longjmp</code>(). In this case,
      <code class="function">setjmp</code>() returns 0.</p>
      <p>The <code class="function">longjmp</code>() function uses
      the information saved in <em class="parameter"><code>env</code></em> to transfer control back to
      the point where <code class="function">setjmp</code>() was
      called and to restore ("rewind") the stack to its state at
      the time of the <code class="function">setjmp</code>() call.
      In addition, and depending on the implementation (see NOTES),
      the values of some other registers and the process signal
      mask may be restored to their state at the time of the
      <code class="function">setjmp</code>() call.</p>
      <p>Following a successful <code class="function">longjmp</code>(), execution continues as if
      <code class="function">setjmp</code>() had returned for a
      second time. This "fake" return can be distinguished from a
      true <code class="function">setjmp</code>() call because the
      "fake" return returns the value provided in <em class="parameter"><code>val</code></em>. If the programmer
      mistakenly passes the value 0 in <em class="parameter"><code>val</code></em>, the "fake" return will
      instead return 1.</p>
      <div class="refsect2">
        <a id="setjmp-3_sect2" name="setjmp-3_sect2" shape="rect"> </a>
        <h3>sigsetjmp() and siglongjmp()</h3>
        <p><code class="function">sigsetjmp</code>() and
        <code class="function">siglongjmp</code>() also perform
        nonlocal gotos, but provide predictable handling of the
        process signal mask.</p>
        <p>If, and only if, the <em class="parameter"><code>savesigs</code></em> argument provided to
        <code class="function">sigsetjmp</code>() is nonzero, the
        process's current signal mask is saved in <em class="parameter"><code>env</code></em> and will be restored if a
        <code class="function">siglongjmp</code>() is later
        performed with this <em class="parameter"><code>env</code></em>.</p>
      </div>
    </div>
    <div class="refsect1">
      <a id="setjmp-3_sect3" name="setjmp-3_sect3" shape="rect"> </a>
      <h2>RETURN VALUE</h2>
      <p><code class="function">setjmp</code>() and <code class="function">sigsetjmp</code>() return 0 when called directly;
      on the "fake" return that occurs after <code class="function">longjmp</code>() or <code class="function">siglongjmp</code>(), the nonzero value specified
      in <em class="parameter"><code>val</code></em> is
      returned.</p>
      <p>The <code class="function">longjmp</code>() or
      <code class="function">siglongjmp</code>() functions do not
      return.</p>
    </div>
    <div class="refsect1">
      <a id="setjmp-3_sect4" name="setjmp-3_sect4" shape="rect"> </a>
      <h2>ATTRIBUTES</h2>
      <p>For an explanation of the terms used in this section, see
      <a class="link" href="../htmlman7/attributes.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">attributes</span>(7)</span></a>.</p>
      <div class="informaltable">
        <table style="border-collapse: collapse;">
          <colgroup span="1">
            <col class="c0" span="1" />
            <col class="c1" span="1" />
            <col class="c2" span="1" />
          </colgroup>
          <tbody>
            <tr>
              <td style="" align="left" rowspan="1" colspan="1">Interface</td>
              <td style="" align="left" rowspan="1" colspan="1">Attribute</td>
              <td style="" align="left" rowspan="1" colspan="1">Value</td>
            </tr>
            <tr>
              <td style="" align="left" rowspan="1" colspan="1"><code class="literal">setjmp</code>(), <code class="literal">sigsetjmp</code>()</td>
              <td style="" align="left" rowspan="1" colspan="1">Thread safety</td>
              <td style="" align="left" rowspan="1" colspan="1">MT-Safe</td>
            </tr>
            <tr>
              <td style="" align="left" rowspan="1" colspan="1"><code class="literal">longjmp</code>(), <code class="literal">siglongjmp</code>()</td>
              <td style="" align="left" rowspan="1" colspan="1">Thread safety</td>
              <td style="" align="left" rowspan="1" colspan="1">MT-Safe</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="refsect1">
      <a id="setjmp-3_sect5" name="setjmp-3_sect5" shape="rect"> </a>
      <h2>CONFORMING TO</h2>
      <p><code class="function">setjmp</code>(), <code class="function">longjmp</code>(): POSIX.1-2001, POSIX.1-2008, C89,
      C99.</p>
      <p><code class="function">sigsetjmp</code>(), <code class="function">siglongjmp</code>(): POSIX.1-2001,
      POSIX.1-2008.</p>
    </div>
    <div class="refsect1">
      <a id="setjmp-3_sect6" name="setjmp-3_sect6" shape="rect"> </a>
      <h2>NOTES</h2>
      <p>POSIX does not specify whether <code class="function">setjmp</code>() will save the signal mask (to be
      later restored during <code class="function">longjmp</code>(). In System V it will not. In
      4.3BSD it will, and there is a function <code class="function">_setjmp</code> that will not. On Linux with glibc
      versions before 2.19, <code class="function">setjmp</code>()
      follows the System V behavior by default, but the BSD
      behavior is provided if the <code class="constant">_BSD_SOURCE</code> feature test macro is defined
      and none of <code class="constant">_POSIX_SOURCE</code>,
      <code class="constant">_POSIX_C_SOURCE</code>, <code class="constant">_XOPEN_SOURCE</code>, <code class="constant">_GNU_SOURCE</code>, or <code class="constant">_SVID_SOURCE</code> is defined. Since glibc 2.19,
      <code class="literal">&lt;</code><code class="filename">setjmp.h</code><code class="literal">&gt;</code>
      exposes only the System V version of <code class="function">setjmp</code>(). Programs that need the BSD
      semantics should replace calls to <code class="function">setjmp</code>() with calls to <code class="function">sigsetjmp</code>() with a nonzero <em class="parameter"><code>savesigs</code></em> argument.</p>
      <p><code class="function">setjmp</code>() and <a class="link" href="../htmlman3/setjmp.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">longjmp</span>(3)</span></a> can be useful
      for dealing with errors inside deeply nested function calls
      or to allow a signal handler to pass control to a specific
      point in the program, rather than returning to the point
      where the handler interrupted the main program. In the latter
      case, if you want to portably save and restore signal masks,
      use <code class="function">sigsetjmp</code>() and
      <code class="function">siglongjmp</code>(). See also the
      discussion of program readability below.</p>
      <p>The compiler may optimize variables into registers, and
      <code class="function">longjmp</code>() may restore the
      values of other registers in addition to the stack pointer
      and program counter. Consequently, the values of automatic
      variables are unspecified after a call to <code class="function">longjmp</code>() if they meet all the following
      criteria:</p>
      <div class="itemizedlist">
        <ul class="itemizedlist" style="list-style-type: disc;">
          <li class="listitem">
            <p>they are local to the function that made the
            corresponding <a class="link" href="../htmlman3/setjmp.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">setjmp</span>(3)</span></a> call;</p>
          </li>
          <li class="listitem">
            <p>their values are changed between the calls to
            <a class="link" href="../htmlman3/setjmp.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">setjmp</span>(3)</span></a> and
            <code class="function">longjmp</code>(); and</p>
          </li>
          <li class="listitem">
            <p>they are not declared as <code class="function">volatile</code>.</p>
          </li>
        </ul>
      </div>
      <p>Analogous remarks apply for <code class="function">siglongjmp</code>().</p>
      <div class="refsect2">
        <a id="setjmp-3_sect7" name="setjmp-3_sect7" shape="rect"> </a>
        <h3>Nonlocal gotos and program readability</h3>
        <p>While it can be abused, the traditional C "goto"
        statement at least has the benefit that lexical cues (the
        goto statement and the target label) allow the programmer
        to easily perceive the flow of control. Nonlocal gotos
        provide no such cues: multiple <code class="function">setjmp</code>() calls might employ the same
        <code class="function">jmp_buf</code> variable so that the
        content of the variable may change over the lifetime of the
        application. Consequently, the programmer may be forced to
        perform detailed reading of the code to determine the
        dynamic target of a particular <code class="function">longjmp</code>() call. (To make the programmer's
        life easier, each <code class="function">setjmp</code>()
        call should employ a unique <code class="function">jmp_buf</code> variable.)</p>
        <p>Adding further difficulty, the <code class="function">setjmp</code>() and <code class="function">longjmp</code>() calls may not even be in the
        same source code module.</p>
        <p>In summary, nonlocal gotos can make programs harder to
        understand and maintain, and an alternative should be used
        if possible.</p>
      </div>
      <div class="refsect2">
        <a id="setjmp-3_sect8" name="setjmp-3_sect8" shape="rect"> </a>
        <h3>Caveats</h3>
        <p>If the function which called <code class="function">setjmp</code>() returns before <code class="function">longjmp</code>() is called, the behavior is
        undefined. Some kind of subtle or unsubtle chaos is sure to
        result.</p>
        <p>If, in a multithreaded program, a <code class="function">longjmp</code>() call employs an <em class="parameter"><code>env</code></em> buffer that was
        initialized by a call to <code class="function">setjmp</code>() in a different thread, the
        behavior is undefined.</p>
        <p>POSIX.1-2008 Technical Corrigendum 2 adds <code class="function">longjmp</code>() and <code class="function">siglongjmp</code>() to the list of
        async-signal-safe functions. However, the standard
        recommends avoiding the use of these functions from signal
        handlers and goes on to point out that if these functions
        are called from a signal handler that interrupted a call to
        a non-async-signal-safe function (or some equivalent, such
        as the steps equivalent to <a class="link" href="../htmlman3/exit.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">exit</span>(3)</span></a> that occur upon a
        return from the initial call to <code class="function">main</code>()), the behavior is undefined if the
        program subsequently makes a call to a
        non-async-signal-safe function. The only way of avoiding
        undefined behavior is to ensure one of the following:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>After long jumping from the signal handler, the
              program does not call any non-async-signal-safe
              functions and does not return from the initial call
              to <code class="function">main</code>().</p>
            </li>
            <li class="listitem">
              <p>Any signal whose handler performs a long jump must
              be blocked during <code class="function">every</code>
              call to a non-async-signal-safe function and no
              non-async-signal-safe functions are called after
              returning from the initial call to <code class="function">main</code>().</p>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="refsect1">
      <a id="setjmp-3_sect9" name="setjmp-3_sect9" shape="rect"> </a>
      <h2>SEE ALSO</h2>
      <p><a class="link" href="../htmlman7/signal.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">signal</span>(7)</span></a></p>
    </div>
    <div class="colophon">
      <a id="setjmp-3_sect10" name="setjmp-3_sect10" shape="rect"> </a>
      <h2>COLOPHON</h2>
      <p>This page is part of release 4.07 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      https://www.kernel.org/doc/man−pages/.</p>
      <div class="license">
        <table style="border-collapse: collapse;">
          <colgroup span="1">
            <col span="1" />
          </colgroup>
          <tbody>
            <tr>
              <td style="" rowspan="1" colspan="1">
                <div class="literallayout">
                  <br />
                    Copyright (C) 2016 Michael Kerrisk &lt;mtk.manpages<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmail.com&gt;<br />

                  <br />
                  %%%LICENSE_START(GPLv2+_DOC_FULL)<br />
                  This is free documentation; you can redistribute it and/or<br />

                  modify it under the terms of the GNU General Public License as<br />

                  published by the Free Software Foundation; either version 2 of<br />

                  the License, or (at your option) any later version.<br />

                  <br />
                  The GNU General Public License's references to "object code"<br />

                  and "executables" are to be interpreted as the output of any<br />

                  document formatting or typesetting system, including<br />

                  intermediate and printed output.<br />

                  <br />
                  This manual is distributed in the hope that it will be useful,<br />

                  but WITHOUT ANY WARRANTY; without even the implied warranty of<br />

                  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the<br />

                  GNU General Public License for more details.<br />

                  <br />
                  You should have received a copy of the GNU General Public<br />

                  License along with this manual; if not, see<br />

                  &lt;<a class="literalurl" href="http://www.gnu.org/licenses/" target="_top" shape="rect">http://www.gnu.org/licenses/</a>&gt;.<br />

                  %%%LICENSE_END<br />
                  <br />
                  Added sigsetjmp, Sun Mar  2 22:03:05 EST 1997, jrv<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>vanzandt.mv.com<br />

                  Modifications, Sun Feb 26 14:39:45 1995, faith<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>cs.unc.edu<br />

                  "<br />
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
